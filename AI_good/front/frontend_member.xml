This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: frontend/src/**/member/**, frontend/src/**/user/**, frontend/src/**/login/**, frontend/src/router/**
- Files matching these patterns are excluded: **/*.map, **/*.min.js, **/*.min.css, **/node_modules/**, **/dist/**, **/target/**, **/vendor/**, **/public/vendor/**, **/logs/**, **/*.log, **/*.svg, **/*.png, **/*.jpg, **/*.ico, AI_good/**
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
frontend/src/router/index.js
frontend/src/views/member/AdminCreateView.vue
frontend/src/views/member/AdminEditView.vue
frontend/src/views/member/AdminHomeView.vue
frontend/src/views/member/AdminInfoModal.vue
frontend/src/views/member/AdminListView.vue
frontend/src/views/member/LoginView.vue
frontend/src/views/member/MemberCreateView.vue
frontend/src/views/member/MemberEditView.vue
frontend/src/views/member/MemberListView.vue
frontend/src/views/member/MemberProfileView.vue
frontend/src/views/member/Register.vue
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="frontend/src/views/member/AdminInfoModal.vue">
<script setup>
import { ref, watch } from 'vue'
import axios from 'axios'
import Swal from 'sweetalert2'

const props = defineProps({
  show: Boolean,
  adminData: Object
})

const emit = defineEmits(['close', 'update-success'])

// è¡¨å–®è³‡æ–™
const form = ref({
  password: '',
  confirmPassword: ''
})

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (dt) => {
  if (!dt) return 'N/A'
  return dt.substring(0, 10).replace(/-/g, '/')
}

// å–å¾—é ­åƒé‚è¼¯ (æ¯”ç…§ä½ çš„ç®¡ç†å“¡åˆ—è¡¨)
const getAvatar = (id) => {
  if (id >= 1 && id <= 10) {
    const fileName = String(id).padStart(2, '0')
    return `/admin/${fileName}.jpg`
  }
  return '/admin/default.png'
}

// å„²å­˜è®Šæ›´
// å„²å­˜è®Šæ›´
const handleSave = async () => {
  // 1. å¦‚æœæ²’è¼¸å…¥å¯†ç¢¼ï¼Œä»£è¡¨ä¸æ”¹å¯†ç¢¼ï¼Œç›´æ¥é—œé–‰
  if (!form.value.password) {
    emit('close')
    return
  }

  // 2. æª¢æŸ¥å…©æ¬¡å¯†ç¢¼æ˜¯å¦ä¸€è‡´
  if (form.value.password !== form.value.confirmPassword) {
    Swal.fire({ icon: 'error', title: 'å¯†ç¢¼ä¸ä¸€è‡´', text: 'è«‹å†æ¬¡ç¢ºèªæ–°å¯†ç¢¼' })
    return
  }

  try {
    // 3. æº–å‚™è¦å‚³çµ¦ AdminController.java çš„ç‰©ä»¶
    // é€™è£¡çš„ key å¿…é ˆå°æ‡‰åˆ°ä½  Admin.java çš„æ¬„ä½åç¨±
    const updateData = {
      admId: props.adminData.admId,       // å¾ props æ‹¿ ID
      admUsername: props.adminData.admUsername, 
      admName: props.adminData.admName,
      admEmail: props.adminData.admEmail,
      admRole: props.adminData.admRole,
      admPassword: form.value.password   // é€™æ˜¯ä½ è¦æ›´æ–°çš„æ–°å¯†ç¢¼
    };

    // 4. æ”¹å‘¼å«ä½ è‡ªå·±çš„ APIï¼š/admins/update
    // é€™è£¡ç”¨ POSTï¼Œå› ç‚ºä½ çš„ Controller å¯«çš„æ˜¯ @PostMapping("/update")
    const response = await axios.post('http://localhost:8080/admins/update', updateData);

    // 5. åˆ¤æ–·å›å‚³å­—ä¸² (å› ç‚ºä½ çš„ Controller å›å‚³çš„æ˜¯ String "ç®¡ç†å“¡ä¿®æ”¹æˆåŠŸ")
    if (response.data === "ç®¡ç†å“¡ä¿®æ”¹æˆåŠŸ") {
      await Swal.fire({ 
        icon: 'success', 
        title: 'å¯†ç¢¼ä¿®æ”¹æˆåŠŸ', 
        timer: 1500, 
        showConfirmButton: false 
      });
      emit('update-success');
      emit('close');
    } else {
      Swal.fire({ icon: 'error', title: 'å„²å­˜å¤±æ•—', text: response.data });
    }

  } catch (error) {
    console.error('æ›´æ–°å¤±æ•—:', error);
    // é€™è£¡å ±éŒ¯é€šå¸¸æ˜¯é€£ç·šå•é¡Œï¼Œå› ç‚ºä½ èµ°çš„æ˜¯è‡ªå·±çš„è·¯å¾‘ï¼Œæ‡‰è©²ä¸æœƒå†æœ‰ 401 äº†
    Swal.fire({ icon: 'error', title: 'é€£ç·šå¤±æ•—', text: 'è«‹æª¢æŸ¥å¾Œç«¯ä¼ºæœå™¨æ˜¯å¦é‹è¡Œ' });
  }
}

// æ¯æ¬¡é–‹å•Ÿæ™‚æ¸…ç©ºå¯†ç¢¼æ¬„ä½
watch(() => props.show, (newVal) => {
  if (newVal) {
    form.value.password = ''
    form.value.confirmPassword = ''
  }
})
</script>

<template>
  <div v-if="show" class="modal-overlay" @click.self="emit('close')">
    <div class="profile-card">
      <div class="profile-header">
        <div class="header-title">
          <i class="fas fa-address-card"></i>
          <span>ç®¡ç†å“¡å€‹äººè³‡è¨Š</span>
        </div>
        <button class="close-x" @click="emit('close')">&times;</button>
      </div>

      <div class="profile-body">
        <div class="left-panel">
          <div class="avatar-wrapper">
            <img :src="getAvatar(adminData?.admId)" />
          </div>
          <h3 class="admin-name">{{ adminData?.admName }}</h3>
          <span class="admin-tag">@{{ adminData?.admUsername }}</span>
        </div>

        <div class="right-panel">
          <div class="info-section">
            <div class="section-divider">å€‹äººè³‡è¨Š</div>
            <div class="detail-grid">
              <div class="detail-item">
                <label>ç®¡ç†å“¡ ID</label>
                <div class="value">{{ adminData?.admId }}</div>
              </div>
              <div class="detail-item">
                <label>é›»å­ä¿¡ç®±</label>
                <div class="value">{{ adminData?.admEmail }}</div>
              </div>
              <div class="detail-item">
                <label>ç›®å‰æ¬Šé™</label>
                <div class="value">
                  <span class="role-badge" :class="adminData?.admRole === 9 ? 'super' : 'normal'">
                    {{ adminData?.admRole === 9 ? 'è¶…ç´šç®¡ç†å“¡' : 'ä¸€èˆ¬ç®¡ç†å“¡' }}
                  </span>
                </div>
              </div>
              <div class="detail-item">
                <label>åˆ°è·æ—¥æœŸ</label>
                <div class="value">{{ formatDate(adminData?.createdAt) }}</div>
              </div>
            </div>
          </div>

          <div class="info-section">
            <div class="section-divider">å®‰å…¨æ€§è¨­å®š</div>
            <div class="password-fields">
              <div class="input-group">
                <label>ä¿®æ”¹å¯†ç¢¼ (ç•™ç©ºå‰‡ä¸æ›´å‹•)</label>
                <input 
                  type="password" 
                  v-model="form.password" 
                  placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼" 
                />
              </div>
              <div class="input-group">
                <label>å†æ¬¡ç¢ºèªæ–°å¯†ç¢¼</label>
                <input 
                  type="password" 
                  v-model="form.confirmPassword" 
                  placeholder="è«‹å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼" 
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="profile-footer">
        <button class="btn-cancel" @click="emit('close')">é—œé–‰è¦–çª—</button>
        <button class="btn-save" @click="handleSave">å„²å­˜è®Šæ›´</button>
      </div>
    </div>
  </div>
</template>

<style scoped>
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(3px);
}

.profile-card {
  background: white;
  width: 750px;
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  overflow: hidden;
}

.profile-header {
  padding: 20px 24px;
  border-bottom: 1px solid #f0f0f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 20px;
  font-weight: 700;
  color: #333;
}

.header-title i {
  color: #1890ff;
}

.close-x {
  border: none;
  background: none;
  font-size: 24px;
  cursor: pointer;
  color: #999;
}

.profile-body {
  display: flex;
  min-height: 400px;
}

/* å·¦å´æ¨£å¼ */
.left-panel {
  flex: 1;
  background: #fcfcfc;
  border-right: 1px solid #f0f0f0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40px 20px;
}

.avatar-wrapper {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 4px solid #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  overflow: hidden;
  margin-bottom: 16px;
}

.avatar-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.admin-name {
  font-size: 22px;
  margin: 0;
  color: #262626;
}

.admin-tag {
  color: #8c8c8c;
  font-size: 14px;
}

/* å³å´æ¨£å¼ */
.right-panel {
  flex: 2;
  padding: 30px;
}

.section-divider {
  font-weight: 600;
  color: #1890ff;
  border-left: 4px solid #1890ff;
  padding-left: 10px;
  margin-bottom: 20px;
}

.detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 30px;
}

.detail-item label {
  display: block;
  font-size: 13px;
  color: #8c8c8c;
  margin-bottom: 4px;
}

.detail-item .value {
  font-size: 15px;
  color: #262626;
  font-weight: 500;
}

.role-badge {
  padding: 2px 10px;
  border-radius: 12px;
  font-size: 12px;
  color: white;
}

.role-badge.super { background: #f5222d; }
.role-badge.normal { background: #1890ff; }

.password-fields {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.input-group label {
  display: block;
  font-size: 13px;
  color: #595959;
  margin-bottom: 6px;
}

.input-group input {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 8px;
  transition: all 0.3s;
}

.input-group input:focus {
  border-color: #40a9ff;
  outline: none;
  box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
}

/* Footer */
.profile-footer {
  padding: 16px 24px;
  border-top: 1px solid #f0f0f0;
  text-align: right;
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

.btn-cancel {
  padding: 8px 20px;
  background: #f0f0f0;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: #595959;
}

.btn-save {
  padding: 8px 20px;
  background: #1890ff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: white;
  transition: background 0.3s;
}

.btn-save:hover {
  background: #40a9ff;
}
</style>
</file>

<file path="frontend/src/views/member/Register.vue">
<script setup>
import { reactive, ref } from 'vue'
import { useRouter } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'

const router = useRouter()

const form = reactive({
  memName: '',
  memUsername: '',
  memEmail: '',
  memPhone: '',
  memPassword: '',
})

const confirmPassword = ref('')

const autoFill = () => {
  form.memName = 'æ—è‚²è¾°'
  form.memUsername = 'demo123'
  form.memEmail = 'alan123145@gmail.com'
  form.memPhone = '0998765432'
  form.memPassword = 'demo987'
  confirmPassword.value = 'demo987'
}

const submit = async () => {
  // 1ï¸âƒ£ ç©ºå€¼æª¢æŸ¥
  if (
    !form.memName ||
    !form.memUsername ||
    !form.memEmail ||
    !form.memPhone ||
    !form.memPassword ||
    !confirmPassword.value
  ) {
    Swal.fire('éŒ¯èª¤', 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½', 'warning')
    return
  }

  // 2ï¸âƒ£ Email æ ¼å¼é©—è­‰
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!emailRegex.test(form.memEmail)) {
    Swal.fire('éŒ¯èª¤', 'é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º', 'error')
    return
  }

  // 3ï¸âƒ£ æ‰‹æ©Ÿè™Ÿç¢¼é©—è­‰ï¼ˆåªå…è¨±æ•¸å­—ï¼Œ8~15 ç¢¼ä½ å¯èª¿ï¼‰
  const phoneRegex = /^\d{8,15}$/
  if (!phoneRegex.test(form.memPhone)) {
    Swal.fire('éŒ¯èª¤', 'æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ä¸æ­£ç¢º', 'error')
    return
  }

  // 4ï¸âƒ£ å¯†ç¢¼ä¸€è‡´æª¢æŸ¥
  if (form.memPassword !== confirmPassword.value) {
    Swal.fire('éŒ¯èª¤', 'å…©æ¬¡å¯†ç¢¼è¼¸å…¥ä¸ä¸€è‡´', 'error')
    return
  }

  // 5ï¸âƒ£ é€å¾Œç«¯
  try {
    await axios.post('http://localhost:8080/api/members/register', form)
    await Swal.fire('æˆåŠŸ', 'è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥', 'success')
    router.push('/login')
  } catch (err) {
    Swal.fire('è¨»å†Šå¤±æ•—', err.response?.data || 'éŒ¯èª¤', 'error')
  }
}

const goLogin = () => {
  router.push('/login')
}
</script>

<template>
  <div class="register-card">
    <h2 class="page-title">æœƒå“¡è¨»å†Š</h2>
    
    <form @submit.prevent="submit" novalidate class="register-form">
      <div class="form-group">
        <label>å§“å</label>
        <input v-model="form.memName" type="text" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" />
      </div>

      <div class="form-group">
        <label>å¸³è™Ÿ</label>
        <input v-model="form.memUsername" type="text" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" />
      </div>

      <div class="form-group">
        <label>é›»å­éƒµä»¶</label>
        <input v-model="form.memEmail" type="text" placeholder="è«‹è¼¸å…¥æ‚¨çš„ E-MAIL" />
      </div>

      <div class="form-group">
        <label>æ‰‹æ©Ÿ</label>
        <input v-model="form.memPhone" type="text" placeholder="è«‹è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿ" />
      </div>

      <div class="form-group">
        <label>å¯†ç¢¼</label>
        <input v-model="form.memPassword" type="password" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼" />
      </div>

      <div class="form-group">
        <label>å†æ¬¡è¼¸å…¥å¯†ç¢¼</label>
        <input v-model="confirmPassword" type="password" placeholder="å†è¼¸å…¥ä¸€æ¬¡å¯†ç¢¼" />
      </div>

      <button type="submit" class="submit-btn">åŠ å…¥æœƒå“¡</button>

      <button type="button" class="demo-btn" @click="autoFill">
        ä¸€éµå¸¶å…¥
      </button>
    </form>

    <div class="back-login-area">
      <div class="back-login" @click="goLogin">
        ğŸ‘¤ æˆ‘å·²ç¶“æœ‰æœƒå“¡å¸³è™Ÿäº†ï¼Ÿ <span>å›ç™»å…¥é é¢</span>
      </div>
    </div>
  </div>
</template>

<style scoped>
/* æ ¸å¿ƒç™½åº•å¡ç‰‡å®¹å™¨ */
.register-card {
  background-color: #ffffff;
  width: 100%;
  max-width: 650px;
  margin: 0 auto;
  padding: 50px 80px;
  border: 1px solid #e8e8e8;
  border-radius: 4px; /* è¼•å¾®åœ“è§’å¢åŠ è³ªæ„Ÿ */
}

/* æ¨™é¡Œæ¨£å¼ */
.page-title {
  text-align: center;
  font-size: 22px;
  font-weight: 600;
  color: #333;
  margin-bottom: 35px;
}

.register-form {
  display: flex;
  flex-direction: column;
}

/* æ¬„ä½ç¾¤çµ„ */
.form-group {
  margin-bottom: 22px;
}

.form-group label {
  display: block;
  font-size: 14px;
  font-weight: bold;
  color: #444;
  margin-bottom: 8px;
}

/* è¼¸å…¥æ¡†æ¨£å¼ï¼šä»¿ç…§åœ–ç‰‡å¯¬é«˜èˆ‡è‰²èª¿ */
.form-group input {
  width: 100%;
  height: 45px;
  padding: 0 15px;
  border: 1px solid #dcdcdc;
  border-radius: 4px;
  font-size: 14px;
  color: #333;
  outline: none;
  transition: all 0.2s ease-in-out;
}

.form-group input:focus {
  border-color: #ff7a66;
  box-shadow: 0 0 4px rgba(255, 122, 102, 0.2);
}

/* æŒ‰éˆ•æ¨£å¼ï¼šçŠç‘šæ©˜æ»¿ç‰ˆè¨­è¨ˆ */
.submit-btn {
  width: 100%;
  height: 50px;
  background-color: #ff7a66;
  color: #ffffff;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 15px;
  transition: background 0.3s;
}

.submit-btn:hover {
  background-color: #ff6650;
}

/* åº•éƒ¨é€£çµå€å¡Š */
.back-login-area {
  margin-top: 30px;
  text-align: center;
}

.back-login {
  font-size: 14px;
  color: #555;
  cursor: pointer;
  display: inline-block;
}

.back-login span {
  color: #0066cc;
  margin-left: 5px;
}

.back-login:hover span {
  text-decoration: underline;
}

/* é‡å°è¡Œå‹•è£ç½®çš„èª¿æ•´ */
@media (max-width: 600px) {
  .register-card {
    padding: 30px 20px;
    border: none;
  }
}

.demo-btn {
  width: 100%;
  height: 40px;
  background-color: #f4f4f4;
  color: #666;
  border: 1px dashed #ccc;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.3s;
}

.demo-btn:hover {
  background-color: #eee;
  border-color: #ff7a66;
  color: #ff7a66;
}
</style>
</file>

<file path="frontend/src/views/member/AdminCreateView.vue">
<script setup>
/**
 * AdminCreateView.vueï¼šæ–°å¢ç®¡ç†å“¡
 */
import { reactive } from 'vue'
import { useRouter } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'

const router = useRouter()

const admin = reactive({
  admUsername: '',
  admPassword: '',
  admName: '',
  admEmail: '',
  admRole: 1,
  adminImage: 'default.png' // 11è™Ÿä»¥å¾Œé è¨­åœ–ç‰‡
})

// é©—è­‰é‚è¼¯
const validateForm = () => {
  // 1. ä¿¡ç®±æ ¼å¼é©—è­‰ï¼šéœ€åŒ…å« @ ä¸”çµå°¾ç‚º .com
  const emailRegex = /^[^\s@]+@[^\s@]+\.com$/
  if (!emailRegex.test(admin.admEmail)) {
    Swal.fire({
      icon: 'warning',
      title: 'æ ¼å¼éŒ¯èª¤',
      text: 'ä¿¡ç®±å¿…é ˆåŒ…å« @ ä¸”ä»¥ .com çµå°¾',
      confirmButtonColor: '#409eff'
    })
    return false
  }

  // 2. å¯†ç¢¼æ ¼å¼é©—è­‰ï¼šè‡³å°‘ 6 ç¢¼ä¸”åŒ…å«è‡³å°‘ 1 å€‹è‹±æ–‡å­—æ¯
  const passwordRegex = /^(?=.*[a-zA-Z]).{6,}$/
  if (!passwordRegex.test(admin.admPassword)) {
    Swal.fire({
      icon: 'warning',
      title: 'å¯†ç¢¼æ ¼å¼éŒ¯èª¤',
      text: 'å¯†ç¢¼éœ€è‡³å°‘ 6 å€‹å­—å…ƒï¼Œä¸¦åŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯',
      confirmButtonColor: '#409eff'
    })
    return false
  }

  // 3. å¿…å¡«æª¢æŸ¥
  if (!admin.admUsername || !admin.admName) {
    Swal.fire({
      icon: 'warning',
      title: 'è³‡æ–™æœªå¡«å¯«',
      text: 'å¸³è™Ÿèˆ‡å§“åç‚ºå¿…å¡«é …ç›®',
      confirmButtonColor: '#409eff'
    })
    return false
  }

  return true
}

const submitCreate = () => {
  if (!validateForm()) return

  axios
    .post('http://localhost:8080/admins', admin)
    .then((res) => {
      Swal.fire({
        icon: 'success',
        title: 'æ–°å¢æˆåŠŸ',
        text: 'ç®¡ç†å“¡å¸³è™Ÿå·²å»ºç«‹',
        timer: 1500,
        showConfirmButton: false
      }).then(() => {
        router.push('/admin/admins')
      })
    })
    .catch((err) => {
      console.error('API Error:', err)
      Swal.fire({
        icon: 'error',
        title: 'æ–°å¢å¤±æ•—',
        text: err.response?.data || 'å¸³è™Ÿå¯èƒ½å·²å­˜åœ¨ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å…§å®¹',
        confirmButtonColor: '#409eff'
      })
    })
}

// ä¸€éµå¸¶å…¥åŠŸèƒ½
const autoFill = () => {
  admin.admUsername = 'demoEmployee'
  admin.admPassword = 'demo987'
  admin.admName = 'æ¸¬è©¦å“¡å·¥'
  admin.admEmail = 'alan123145@gmail.com'
  admin.admRole = 1
}

const goBack = () => {
  router.push('/admin/admins')
}
</script>

<template>
  <div class="create-page">
    <div class="form-card">
      <div class="card-header">
        <div class="header-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <h2>æ–°å¢ç®¡ç†å“¡</h2>
        <p>å»ºç«‹æ–°çš„ç³»çµ±ç®¡ç†å“¡å¸³è™Ÿ</p>
      </div>

      <el-form @submit.prevent="submitCreate" label-position="top" class="admin-form">
        <el-form-item label="å¸³è™Ÿ" required>
          <el-input
            v-model="admin.admUsername"
            placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
            prefix-icon="User"
            autocomplete="new-username"
          />
        </el-form-item>

        <el-form-item label="å¯†ç¢¼" required>
          <el-input
            type="password"
            v-model="admin.admPassword"
            placeholder="è‡³å°‘ 6 ç¢¼ä¸”åŒ…å«è‹±æ–‡å­—æ¯"
            prefix-icon="Lock"
            autocomplete="new-password"
            show-password
          />
        </el-form-item>

        <el-form-item label="å§“å" required>
          <el-input
            v-model="admin.admName"
            placeholder="è«‹è¼¸å…¥å§“å"
            prefix-icon="UserFilled"
          />
        </el-form-item>

        <el-form-item label="ä¿¡ç®±" required>
          <el-input
            v-model="admin.admEmail"
            placeholder="example@mail.com"
            prefix-icon="Message"
          />
        </el-form-item>

        <el-form-item label="è§’è‰²">
          <el-select v-model="admin.admRole" placeholder="é¸æ“‡è§’è‰²" style="width: 100%">
            <el-option :value="1" label="ä¸€èˆ¬ç®¡ç†å“¡">
              <span class="role-option">
                <i class="fas fa-user-tie mr-2"></i> ä¸€èˆ¬ç®¡ç†å“¡
              </span>
            </el-option>
            <el-option :value="9" label="è¶…ç´šç®¡ç†å“¡">
              <span class="role-option">
                <i class="fas fa-crown mr-2"></i> è¶…ç´šç®¡ç†å“¡
              </span>
            </el-option>
          </el-select>
        </el-form-item>

        <div class="form-actions">
          <el-button 
            type="primary" 
            size="large" 
            native-type="submit" 
            class="submit-btn"
          >
            <i class="fas fa-check mr-2"></i> ç¢ºèªæ–°å¢
          </el-button>

          <el-button 
              type="info" 
              plain 
              size="large" 
              @click="autoFill" 
              class="demo-btn"
          >
            <i class="fas fa-magic mr-2"></i> ä¸€éµå¸¶å…¥
          </el-button>

          <el-button size="large" @click="goBack" class="back-btn" style="margin-left: 0">
            <i class="fas fa-arrow-left mr-2"></i> å›ç®¡ç†å“¡åˆ—è¡¨
          </el-button>
        </div>
      </el-form>
    </div>
  </div>
</template>

<style scoped>
/* ========== é é¢å®¹å™¨ ========== */
.create-page {
  min-height: 100vh;
  padding: 40px 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ========== è¡¨å–®å¡ç‰‡ ========== */
.form-card {
  width: 100%;
  max-width: 480px;
  background: white;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  animation: slideUp 0.5s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ========== æ¨™é¡Œå€åŸŸ ========== */
.card-header {
  text-align: center;
  margin-bottom: 32px;
}

.header-icon {
  width: 72px;
  height: 72px;
  background: linear-gradient(135deg, #e8f4fc 0%, #d4e8f7 100%);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: #5b9bd5;
  margin: 0 auto 16px;
  box-shadow: 0 4px 15px rgba(91, 155, 213, 0.15);
}

.card-header h2 {
  margin: 0;
  font-size: 1.6rem;
  font-weight: 700;
  color: #303133;
}

.card-header p {
  margin: 8px 0 0;
  color: #909399;
  font-size: 0.95rem;
}

/* ========== è¡¨å–®æ¨£å¼ ========== */
.admin-form {
  margin-top: 24px;
}

.admin-form :deep(.el-form-item__label) {
  font-weight: 600;
  color: #606266;
}

.admin-form :deep(.el-input__wrapper) {
  border-radius: 10px;
  padding: 4px 12px;
}

.admin-form :deep(.el-select .el-input__wrapper) {
  border-radius: 10px;
}

.role-option {
  display: flex;
  align-items: center;
}

/* ========== æŒ‰éˆ•å€åŸŸ ========== */
.form-actions {
  margin-top: 32px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.submit-btn {
  width: 100%;
  height: 48px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  background: linear-gradient(135deg, #5b9bd5 0%, #7cb9e8 100%);
  border: none;
  transition: all 0.3s ease;
  cursor: pointer;
  color: white;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(91, 155, 213, 0.35);
  filter: brightness(1.1);
}

.submit-btn:active {
  transform: scale(0.95);
}

.back-btn {
  width: 100%;
  height: 44px;
  font-size: 15px;
  border-radius: 10px;
  border: 2px solid #e8ecf1;
  background: transparent;
  color: #606266;
  transition: all 0.3s ease;
  cursor: pointer;
}

.back-btn:hover {
  border-color: #5b9bd5;
  color: #5b9bd5;
  background: rgba(91, 155, 213, 0.05);
}

.back-btn:active {
  transform: scale(0.95);
}

/* ========== å·¥å…·é¡ ========== */
.mr-2 { 
  margin-right: 8px; 
}

/* ========== éŸ¿æ‡‰å¼è¨­è¨ˆ ========== */
@media (max-width: 520px) {
  .form-card {
    padding: 24px;
    margin: 16px;
  }
  
  .header-icon {
    width: 60px;
    height: 60px;
    font-size: 24px;
  }
}

/* ========== ä¸€éµå¸¶å…¥æŒ‰éˆ•æ¨£å¼ ========== */
.demo-btn {
  width: 100%;
  height: 44px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px dashed #909399; /* è™›ç·šé‚Šæ¡† */
  background: #f8f9fa;
  color: #606266;
  transition: all 0.3s ease;
  cursor: pointer;
  margin-left: 0 !important; /* å¼·åˆ¶è¦†è“‹ Element Plus é è¨­é–“è· */
}

.demo-btn:hover {
  background: #f0f2f5;
  border-color: #5b9bd5;
  color: #5b9bd5;
  transform: translateY(-1px);
}

.demo-btn:active {
  transform: scale(0.98);
}
</style>
</file>

<file path="frontend/src/views/member/AdminEditView.vue">
<script setup>
/**
 * AdminEditView.vueï¼šç·¨è¼¯ç®¡ç†å“¡ (å®Œæ•´é©—è­‰èˆ‡ SweetAlert ç‰ˆ)
 */
import { ref, onMounted } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'

const router = useRouter()
const route = useRoute()

const admin = ref(null)
const newPassword = ref('')
const errorMsg = ref('')
const loading = ref(false)

// è¼‰å…¥è³‡æ–™
const fetchAdmin = () => {
  loading.value = true
  const id = route.params.id
  axios
    .get(`http://localhost:8080/admins/find?admId=${id}`)
    .then((res) => {
      // res.data æ‡‰åŒ…å« adminImage æ¬„ä½
      admin.value = res.data
    })
    .catch(() => {
      errorMsg.value = 'è¼‰å…¥ç®¡ç†å“¡è³‡æ–™å¤±æ•—'
    })
    .finally(() => {
      loading.value = false
    })
}

// é©—è­‰é‚è¼¯
const validateForm = () => {
  // 1. ä¿¡ç®±æ ¼å¼é©—è­‰ï¼šéœ€åŒ…å« @ ä¸”çµå°¾ç‚º .com
  const emailRegex = /^[^\s@]+@[^\s@]+\.com$/
  if (!emailRegex.test(admin.value.admEmail)) {
    Swal.fire({
      icon: 'warning',
      title: 'ä¿¡ç®±æ ¼å¼éŒ¯èª¤',
      text: 'é›»å­éƒµä»¶å¿…é ˆåŒ…å« @ ä¸”ä»¥ .com çµå°¾',
      confirmButtonColor: '#409eff'
    })
    return false
  }

  // 2. å¯†ç¢¼æ ¼å¼é©—è­‰ï¼šå¦‚æœæœ‰å¡«å¯«æ–°å¯†ç¢¼ï¼Œå‰‡éœ€è‡³å°‘ 6 ç¢¼ + 1 è‹±æ–‡å­—
  if (newPassword.value && newPassword.value.trim() !== '') {
    const passwordRegex = /^(?=.*[a-zA-Z]).{6,}$/
    if (!passwordRegex.test(newPassword.value)) {
      Swal.fire({
        icon: 'warning',
        title: 'æ–°å¯†ç¢¼æ ¼å¼ä¸ç¬¦',
        text: 'æ–°å¯†ç¢¼éœ€è‡³å°‘ 6 å€‹å­—å…ƒï¼Œä¸”åŒ…å«è‡³å°‘ 1 å€‹è‹±æ–‡å­—æ¯',
        confirmButtonColor: '#409eff'
      })
      return false
    }
  }

  return true
}

// æäº¤ä¿®æ”¹
const submitEdit = () => {
  if (!validateForm()) return

  const payload = {
    ...admin.value,
    admPassword: newPassword.value || '', // å¦‚æœæ²’å¡«å°±å‚³ç©ºå­—ä¸²ï¼Œå¾Œç«¯æœƒåˆ¤æ–·ä¸æ›´æ–°å¯†ç¢¼
  }

  axios
    .post('http://localhost:8080/admins/update', payload)
    .then(() => {
      Swal.fire({
        icon: 'success',
        title: 'ä¿®æ”¹æˆåŠŸ',
        text: 'ç®¡ç†å“¡è³‡æ–™å·²æˆåŠŸæ›´æ–°',
        timer: 1500,
        showConfirmButton: false
      }).then(() => {
        router.push('/admin/admins')
      })
    })
    .catch((err) => {
      console.error('Update Error:', err)
      Swal.fire({
        icon: 'error',
        title: 'ä¿®æ”¹å¤±æ•—',
        text: 'è«‹æª¢æŸ¥è¼¸å…¥è³‡æ–™æˆ–é€£ç·šç‹€æ³',
        confirmButtonColor: '#409eff'
      })
    })
}

const goBack = () => {
  router.push('/admin/admins')
}

onMounted(() => {
  fetchAdmin()
})
</script>

<template>
  <div class="edit-page">
    <div class="form-card">
      <div class="card-header">
        <div class="header-icon">
          <i class="fas fa-user-edit"></i>
        </div>
        <h2>ä¿®æ”¹ç®¡ç†å“¡è³‡æ–™</h2>
        <p>ç·¨è¼¯ç¾æœ‰ç®¡ç†å“¡çš„å¸³è™Ÿè³‡è¨Š</p>
      </div>

      <el-alert 
        v-if="errorMsg" 
        :title="errorMsg" 
        type="error" 
        show-icon 
        :closable="false" 
        class="error-alert" 
      />
      
      <div v-if="loading" class="loading-state">
        <i class="fas fa-spinner fa-spin loading-icon"></i>
        <p>è³‡æ–™è¼‰å…¥ä¸­...</p>
      </div>

      <el-form v-else-if="admin" @submit.prevent="submitEdit" label-position="top" class="admin-form">
        <input type="hidden" v-model="admin.admId" />

        <el-form-item label="å¸³è™Ÿ" required>
          <el-input
            v-model="admin.admUsername"
            placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
            prefix-icon="User"
          />
        </el-form-item>

        <el-form-item label="æ–°å¯†ç¢¼">
          <el-input
            type="password"
            v-model="newPassword"
            placeholder="è‹¥ä¸ä¿®æ”¹è«‹ç•™ç©º"
            prefix-icon="Lock"
            show-password
          />
          <div class="form-hint">
            <i class="fas fa-info-circle"></i>
            éœ€è‡³å°‘ 6 ç¢¼ä¸¦å« 1 å€‹è‹±æ–‡å­—ï¼Œä¸ä¿®æ”¹è«‹ä¿æŒç©ºç™½
          </div>
        </el-form-item>

        <el-form-item label="å§“å" required>
          <el-input
            v-model="admin.admName"
            placeholder="è«‹è¼¸å…¥å§“å"
            prefix-icon="UserFilled"
          />
        </el-form-item>

        <el-form-item label="ä¿¡ç®±" required>
          <el-input
            v-model="admin.admEmail"
            placeholder="example@mail.com"
            prefix-icon="Message"
          />
        </el-form-item>

        <el-form-item label="è§’è‰²">
          <el-select v-model="admin.admRole" placeholder="é¸æ“‡è§’è‰²" style="width: 100%">
            <el-option :value="1" label="ä¸€èˆ¬ç®¡ç†å“¡">
              <span class="role-option">
                <i class="fas fa-user-tie mr-2"></i> ä¸€èˆ¬ç®¡ç†å“¡
              </span>
            </el-option>
            <el-option :value="9" label="è¶…ç´šç®¡ç†å“¡">
              <span class="role-option">
                <i class="fas fa-crown mr-2"></i> è¶…ç´šç®¡ç†å“¡
              </span>
            </el-option>
          </el-select>
        </el-form-item>

        <div class="form-actions">
          <el-button 
            type="primary" 
            size="large" 
            native-type="submit" 
            class="submit-btn"
          >
            <i class="fas fa-save mr-2"></i> ç¢ºèªä¿®æ”¹
          </el-button>
          <el-button 
            size="large" 
            @click="goBack" 
            class="back-btn"
            style="margin-left: 0"
          >
            <i class="fas fa-arrow-left mr-2"></i> å›ç®¡ç†å“¡åˆ—è¡¨
          </el-button>
        </div>
      </el-form>
    </div>
  </div>
</template>

<style scoped>
/* ========== é é¢å®¹å™¨ ========== */
.edit-page {
  min-height: 100vh;
  padding: 40px 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ========== è¡¨å–®å¡ç‰‡ ========== */
.form-card {
  width: 100%;
  max-width: 480px;
  background: white;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  animation: slideUp 0.5s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ========== æ¨™é¡Œå€åŸŸ ========== */
.card-header {
  text-align: center;
  margin-bottom: 32px;
}

.header-icon {
  width: 72px;
  height: 72px;
  background: linear-gradient(135deg, #e8f4fc 0%, #d4e8f7 100%);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: #5b9bd5;
  margin: 0 auto 16px;
  box-shadow: 0 4px 15px rgba(91, 155, 213, 0.15);
}

.card-header h2 {
  margin: 0;
  font-size: 1.6rem;
  font-weight: 700;
  color: #303133;
}

.card-header p {
  margin: 8px 0 0;
  color: #909399;
  font-size: 0.95rem;
}

/* ========== è¼‰å…¥ç‹€æ…‹ ========== */
.loading-state {
  text-align: center;
  padding: 40px;
}

.loading-icon {
  font-size: 36px;
  color: #409eff;
  margin-bottom: 16px;
}

.loading-state p {
  color: #909399;
  font-size: 15px;
}

/* ========== éŒ¯èª¤æç¤º ========== */
.error-alert {
  margin-bottom: 20px;
  border-radius: 10px;
}

/* ========== è¡¨å–®æ¨£å¼ ========== */
.admin-form {
  margin-top: 24px;
}

.admin-form :deep(.el-form-item__label) {
  font-weight: 600;
  color: #606266;
}

.admin-form :deep(.el-input__wrapper) {
  border-radius: 10px;
  padding: 4px 12px;
}

.admin-form :deep(.el-select .el-input__wrapper) {
  border-radius: 10px;
}

.form-hint {
  margin-top: 6px;
  font-size: 12px;
  color: #909399;
  display: flex;
  align-items: center;
  gap: 6px;
}

.form-hint i {
  color: #409eff;
}

.role-option {
  display: flex;
  align-items: center;
}

/* ========== æŒ‰éˆ•å€åŸŸ ========== */
.form-actions {
  margin-top: 32px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.submit-btn {
  width: 100%;
  height: 48px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  background: linear-gradient(135deg, #5b9bd5 0%, #7cb9e8 100%);
  border: none;
  transition: all 0.3s ease;
  color: white;
  cursor: pointer;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(91, 155, 213, 0.35);
}

.submit-btn:active {
  transform: scale(0.95);
}

.back-btn {
  width: 100%;
  height: 44px;
  font-size: 15px;
  border-radius: 10px;
  border: 2px solid #e8ecf1;
  background: transparent;
  color: #606266;
  transition: all 0.3s ease;
  cursor: pointer;
}

.back-btn:hover {
  border-color: #5b9bd5;
  color: #5b9bd5;
  background: rgba(91, 155, 213, 0.05);
}

.back-btn:active {
  transform: scale(0.95);
}

/* ========== å·¥å…·é¡ ========== */
.mr-2 { 
  margin-right: 8px; 
}

/* ========== éŸ¿æ‡‰å¼è¨­è¨ˆ ========== */
@media (max-width: 520px) {
  .form-card {
    padding: 24px;
    margin: 16px;
  }
  
  .header-icon {
    width: 60px;
    height: 60px;
    font-size: 24px;
  }
}
</style>
</file>

<file path="frontend/src/views/member/LoginView.vue">
<script setup>
import { ref, reactive, watch } from 'vue' // å¼•å…¥ reactive
import { useRouter, useRoute } from 'vue-router' // å¼•å…¥ useRoute
import axios from 'axios'

//  SweetAlert2ï¼šçµ±ä¸€ç”¨å½ˆçª—é¡¯ç¤ºæˆåŠŸ/å¤±æ•—è¨Šæ¯ï¼ˆå–ä»£ errorMsg/successMsgï¼‰
import Swal from 'sweetalert2'

//  Piniaï¼šå¼•å…¥å…©ç¨® store
import { useAdminAuthStore } from '@/stores/adminAuth'
import { useMemberAuthStore } from '@/stores/memberAuth'

const adminAuthStore = useAdminAuthStore()
const memberAuthStore = useMemberAuthStore()
const router = useRouter()
const route = useRoute() // å»ºç«‹ route å¯¦ä¾‹

/**
 * ç™»å…¥é¡å‹ï¼š
 * - memberï¼šæœƒå“¡ç™»å…¥ï¼ˆå°å‘ /member/profileï¼‰
 * - adminï¼šç®¡ç†å“¡ç™»å…¥ï¼ˆå°å‘ /adminï¼‰
 */
const loginType = ref('member') // member | admin

// --- å¿˜è¨˜å¯†ç¢¼ç›¸é—œç‹€æ…‹ ---
const viewMode = ref('login') // login | forgot | reset
const forgotForm = reactive({
  email: '',
  code: '',
  newPassword: '',
  confirmPassword: ''
})

// è¿”å›ç™»å…¥ä¸¦æ¸…ç©ºè³‡æ–™
const backToLogin = () => {
  viewMode.value = 'login'
  forgotForm.email = ''
  forgotForm.code = ''
}
// -----------------------

// å…±ç”¨è¼¸å…¥æ¬„ä½ï¼ˆæœƒå“¡/ç®¡ç†å“¡éƒ½ç”¨åŒä¸€çµ„æ¬„ä½ï¼‰
const account = ref('')
const password = ref('')

// åˆ‡æ›ç™»å…¥èº«åˆ†æ™‚ï¼Œæ¸…ç©ºè¼¸å…¥ï¼Œé¿å…èª¤é€ä¸Šä¸€ç¨®èº«åˆ†çš„å¸³å¯†
watch(loginType, () => {
  account.value = ''
  password.value = ''
})

/**
 * ç™»å…¥ä¸»æµç¨‹ï¼ˆasync/awaitï¼‰
 * ç›®çš„ï¼š
 * 1) é¿å… Promise then/catch çš„é †åº race condition
 * 2) ç¢ºä¿ã€Œå…ˆå¯«å…¥ localStorageã€å†å°é ï¼Œè·¯ç”±å®ˆè¡›æ‰æœƒæ”¾è¡Œ
 */
const login = async () => {
  try {
    // =========================
    // æœƒå“¡ç™»å…¥
    // =========================
    if (loginType.value === 'member') {
      const res = await axios.post(
        'http://localhost:8080/login/member',
        {
          memUsername: account.value,
          memPassword: password.value,
        },
        {
          withCredentials: true,
        },
      )

      /**
       * token å„²å­˜è¦å‰‡ï¼ˆçµ±ä¸€ localStorageï¼‰
       * - main.js çš„ axios interceptor å¾ localStorage å– token
       * - æ‰€ä»¥é€™è£¡ä¹Ÿå¿…é ˆå­˜ localStorage
       * - è‹¥å¾Œç«¯æ²’å› tokenï¼Œæš«ç”¨ 'login-ok'ï¼ˆä½ åŸæœ¬ HEAD çš„ç­–ç•¥ï¼‰é¿å…æµç¨‹å¡æ­»
       */
      const token = res.data?.token || 'login-ok'
      localStorage.setItem('token', token)

      adminAuthStore.clearAdmin()
      localStorage.removeItem('admin')

      //  [+] å°‡ç™»å…¥ç‹€æ…‹å­˜å…¥ Piniaï¼Œè®“æ•´å€‹ App ä¿æŒåŒæ­¥
      memberAuthStore.setMemberLogin({
        memId: res.data.memId,
        memUsername: res.data.memUsername,
        memName: res.data.memName,
        memPoints: res.data.memPoints,
        memInvoice: res.data.memInvoice,
      })

      //  [+] å°‡æœƒå“¡è³‡æ–™å­˜å…¥ localStorageï¼Œå¯¦ç¾æŒä¹…åŒ–ç™»å…¥
      localStorage.setItem('member_user', JSON.stringify(res.data))

      // æˆåŠŸæç¤º
      await Swal.fire({
        icon: 'success',
        title: 'ç™»å…¥æˆåŠŸ',
        text: 'æ­¡è¿å›ä¾†ï¼',
        showConfirmButton: false,
        timer: 1200,
      })

      //  æª¢æŸ¥æ˜¯å¦æœ‰é‡å®šå‘è·¯å¾‘ï¼Œè‹¥æœ‰å‰‡è·³è½‰ï¼Œå¦å‰‡å°å‘æœƒå“¡é 
      if (route.query.redirect) {
        router.push(route.query.redirect)
      } else {
        router.push('/')
      }
      return
    }

    // =========================
    // ç®¡ç†å“¡ç™»å…¥ (æœ€ç°¡åŒ–ä¿®æ­£ç‰ˆ)
    // =========================
    const res = await axios.post(
      'http://localhost:8080/login/admin',
      {
        admUsername: account.value,
        admPassword: password.value,
      },
      {
        withCredentials: true,
      },
    )

    // 1. åªæ¸…æ‰ã€Œæœƒå“¡ã€çš„è³‡æ–™ï¼Œä¸è¦ç”¨ clear()
    localStorage.removeItem('member_user')
    memberAuthStore.clearMemberLogin()

    // 2. å­˜å…¥ç®¡ç†å“¡ Token èˆ‡è³‡æ–™
    const token = res.data?.token || 'admin-login-ok'
    localStorage.setItem('token', token)

    const adminData = {
      username: res.data?.admUsername,
      name: res.data?.admName,
      role: res.data?.admRole,
      admId: res.data?.admId,          // è£œä¸Š ID
      admEmail: res.data?.admEmail,    // è£œä¸Š Email
      admCreatedAt: res.data?.admCreatedAt // è£œä¸Šåˆ°è·æ—¥
    }

    // 3. åŒæ­¥å¯«å…¥ Pinia å’Œ LocalStorage
    adminAuthStore.setAdmin(adminData)
    localStorage.setItem('admin', JSON.stringify(adminData))

    // 4. æˆåŠŸæç¤º
    await Swal.fire({
      icon: 'success',
      title: 'ç®¡ç†å“¡ç™»å…¥æˆåŠŸ',
      text: 'æ­¡è¿å›ä¾†ï¼',
      showConfirmButton: false,
      timer: 1000,
    })

    //  é€²å¾Œå°ï¼ˆreplace é¿å…å›ä¸Šä¸€é åˆå›åˆ°ç™»å…¥é ï¼‰
    router.push('/admin')
  } catch (err) {
    console.error(err)

    // éŒ¯èª¤è¨Šæ¯æ•´ç†ï¼šå¾Œç«¯å¯èƒ½å›å­—ä¸²æˆ–ç‰©ä»¶
    let errorText = 'ç™»å…¥å¤±æ•—'
    if (err.response && err.response.data) {
      const msg = err.response.data
      errorText = typeof msg === 'object' ? JSON.stringify(msg) : String(msg)
    }

    // å¤±æ•—æç¤º
    Swal.fire({
      icon: 'error',
      title: 'ç™»å…¥å¤±æ•—',
      text: errorText,
      confirmButtonText: 'ç¢ºèª',
    })
  }
}

// ç™¼é€é©—è­‰ç¢¼é‚è¼¯
const handleSendCode = async () => {
  if (!forgotForm.email) {
    Swal.fire('éŒ¯èª¤', 'è«‹å¡«å¯«é›»å­éƒµä»¶', 'warning')
    return
  }
  // é¡¯ç¤ºè®€å–ä¸­ï¼Œå› ç‚ºå¯„ä¿¡éœ€è¦ 2~5 ç§’
  Swal.fire({
    title: 'æ­£åœ¨ç™¼é€é©—è­‰ç¢¼...',
    allowOutsideClick: false,
    didOpen: () => { Swal.showLoading() }
  })
  try {
    // æ ¹æ“šç›®å‰çš„ç™»å…¥èº«åˆ†(member/admin)æ±ºå®š API è·¯å¾‘
    const url = loginType.value === 'admin' 
      ? 'http://localhost:8080/api/admin/forgot-password/send-code' 
      : 'http://localhost:8080/api/forgot-password/send-code';

    await axios.post(url, { email: forgotForm.email })
    
    Swal.close() // é—œé–‰ Loading
    await Swal.fire('æˆåŠŸ', 'é©—è­‰ç¢¼å·²ç™¼é€è‡³æ‚¨çš„ä¿¡ç®±', 'success')
    viewMode.value = 'reset'
  } catch (err) {
    Swal.close()
    console.error(err)
    // é¡¯ç¤ºå¾Œç«¯å‚³å›çš„éŒ¯èª¤è¨Šæ¯ï¼ˆä¾‹å¦‚ï¼šå¸³è™Ÿä¸å­˜åœ¨ï¼‰
    const errorMsg = err.response?.data || 'ç™¼é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ä¿¡ç®±'
    Swal.fire('å¤±æ•—', errorMsg, 'error')
  }
}

// é‡è¨­å¯†ç¢¼é‚è¼¯
const handleResetPassword = async () => {
  // åŸºæœ¬æª¢æŸ¥
  if (!forgotForm.code || !forgotForm.newPassword) {
    Swal.fire('éŒ¯èª¤', 'è«‹å®Œæ•´å¡«å¯«é©—è­‰ç¢¼èˆ‡æ–°å¯†ç¢¼', 'warning')
    return
  }

  if (forgotForm.newPassword !== forgotForm.confirmPassword) {
    Swal.fire('éŒ¯èª¤', 'å…©æ¬¡å¯†ç¢¼è¼¸å…¥ä¸ä¸€è‡´', 'error')
    return
  }

  try {
    // æ ¹æ“šç›®å‰çš„ç™»å…¥èº«åˆ†(member/admin)æ±ºå®š API è·¯å¾‘
    const url = loginType.value === 'admin' 
      ? 'http://localhost:8080/api/admin/forgot-password/reset' 
      : 'http://localhost:8080/api/forgot-password/reset';

    await axios.post(url, forgotForm)
    
    await Swal.fire('æˆåŠŸ', 'å¯†ç¢¼é‡è¨­æˆåŠŸï¼Œè«‹é‡æ–°ç™»å…¥', 'success')
    backToLogin()
  } catch (err) {
    console.error(err)
    const errorMsg = err.response?.data || 'é©—è­‰ç¢¼éŒ¯èª¤æˆ–å·²éæœŸ'
    Swal.fire('é‡è¨­å¤±æ•—', errorMsg, 'error')
  }
}

/**
 * Particles èƒŒæ™¯è¨­å®šï¼ˆåªå½±éŸ¿è¦–è¦ºï¼Œä¸å½±éŸ¿ç™»å…¥é‚è¼¯ï¼‰
 * æ³¨æ„ï¼šmain.js éœ€å·² app.use(Particles) ä¸”å·²è¼‰å…¥ loadSlim
 */
const particlesOptions = {
  background: {
    color: { value: '#e9ecef' },
  },
  particles: {
    color: { value: '#6c757d' },
    links: {
      enable: true,
      color: '#6c757d',
      distance: 150,
      opacity: 0.3,
      width: 1,
    },
    move: {
      enable: true,
      speed: 1.2,
    },
    number: {
      value: 60,
    },
    size: {
      value: { min: 1, max: 3 },
    },
  },
  interactivity: {
    events: {
      onHover: {
        enable: true,
        mode: 'grab',
      },
    },
  },
}

const goRegister = () => {
  router.push('/register')
}

const loginWithGoogle = () => {
  // åŠ ä¸Šæ™‚é–“æˆ³è¨˜ t=${Date.now()} ç¢ºä¿æ¯æ¬¡è«‹æ±‚éƒ½æ˜¯æ–°çš„ï¼Œä¸è¢«ç€è¦½å™¨ç·©å­˜ç¶²å€
  const googleLoginUrl = `http://localhost:8080/oauth2/authorization/google?prompt=select_account&t=${Date.now()}`
  window.location.href = googleLoginUrl
}
</script>

<template>
  <div class="login-page">
    <vue-particles id="tsparticles" :options="particlesOptions" class="particles-bg" />

    <div class="login-box">
      <div class="card card-outline card-primary">
        <div class="card-header text-center">
          <h1 class="h1"><b>SeatRentSys</b></h1>
        </div>
        <div class="card-body">
          
          <div v-if="viewMode === 'login'">
            <div class="login-switch">
              <button
                :class="{ active: loginType === 'member' }"
                @click="loginType = 'member'"
                type="button"
              >
                æœƒå“¡ç™»å…¥
              </button>

              <button
                :class="{ active: loginType === 'admin' }"
                @click="loginType = 'admin'"
                type="button"
              >
                ç®¡ç†å“¡ç™»å…¥
              </button>
            </div>

            <form @submit.prevent="login">
              <div class="input-group mb-3">
                <input
                  v-model="account"
                  type="text"
                  class="form-control"
                  :placeholder="loginType === 'member' ? 'æœƒå“¡å¸³è™Ÿ' : 'ç®¡ç†å“¡å¸³è™Ÿ'"
                  required
                />
              </div>
              <div class="input-group mb-3">
                <input
                  v-model="password"
                  type="password"
                  class="form-control"
                  :placeholder="loginType === 'member' ? 'æœƒå“¡å¯†ç¢¼' : 'ç®¡ç†å“¡å¯†ç¢¼'"
                  required
                />
              </div>

              <div class="helper-links">
                <span v-if="loginType === 'member'" @click="goRegister">è¨»å†Šæœƒå“¡</span>
                
                <span v-else></span>

                <span @click="viewMode = 'forgot'">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</span>
              </div>

              <div class="google-login-section">
                <div class="divider">
                  <span>æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹ç™»å…¥</span>
                </div>

                <button type="button" class="btn-google" @click="loginWithGoogle">
                  <img
                    src="https://developers.google.com/static/identity/images/g-logo.png"
                    alt="Google"
                  />
                  ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
                </button>
              </div>

              <button type="submit" class="btn btn-primary btn-block">ç™»å…¥</button>
              <div class="back-to-home" @click="router.push('/')">
                <el-icon><ArrowLeft /></el-icon>
                <span>è¿”å›é¦–é </span>
              </div>
            </form>
          </div>

          <div v-else-if="viewMode === 'forgot'">
            <h2 class="sub-title">å¿˜è¨˜å¯†ç¢¼</h2>
            <p class="desc-text">è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶ï¼Œæˆ‘å€‘å°‡ç™¼é€é©—è­‰ç¢¼è‡³æ‚¨çš„ä¿¡ç®±</p>
            
            <div class="input-group mb-3">
              <input
                v-model="forgotForm.email"
                type="email"
                class="form-control"
                placeholder="è«‹è¼¸å…¥è¨»å†Šçš„ E-MAIL"
              />
            </div>
            
            <button @click="handleSendCode" class="btn btn-primary btn-block">ç™¼é€é©—è­‰ç¢¼</button>
            
            <div class="back-link-center" @click="backToLogin">
              <span>è¿”å›ç™»å…¥é é¢</span>
            </div>
          </div>

          <div v-else-if="viewMode === 'reset'">
            <h2 class="sub-title">é‡è¨­å¯†ç¢¼</h2>
            <div class="info-text">é©—è­‰ç¢¼å·²ç™¼é€è‡³ï¼š{{ forgotForm.email }}</div>
            
            <div class="input-group mb-3">
              <input v-model="forgotForm.code" type="text" class="form-control" placeholder="è«‹è¼¸å…¥ 6 ä½é©—è­‰ç¢¼" />
            </div>
            <div class="input-group mb-3">
              <input v-model="forgotForm.newPassword" type="password" class="form-control" placeholder="æ–°å¯†ç¢¼" />
            </div>
            <div class="input-group mb-3">
              <input v-model="forgotForm.confirmPassword" type="password" class="form-control" placeholder="å†æ¬¡ç¢ºèªæ–°å¯†ç¢¼" />
            </div>
            
            <button @click="handleResetPassword" class="btn btn-primary btn-block">ç¢ºèªé‡è¨­</button>
            
            <div class="back-link-center" @click="viewMode = 'forgot'">
              <span>é‡æ–°è¼¸å…¥é›»å­éƒµä»¶</span>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
/* ========== ç™»å…¥é é¢ä¸»å®¹å™¨ ========== */
.login-page {
  position: relative;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: linear-gradient(135deg, #9db8d4 0%, #8aa5c1 100%);
}

/* ç²’å­èƒŒæ™¯ï¼šæœ€åº•å±¤ */
.particles-bg {
  position: fixed;
  inset: 0;
  z-index: 0;
}

/* ========== ç™»å…¥æ¡†ï¼šGlassmorphism é¢¨æ ¼ ========== */
.login-box {
  width: 400px;
  position: relative;
  z-index: 10;
}

.login-box .card {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
  overflow: hidden;
}

.login-box .card-header {
  background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
  padding: 24px;
  border-bottom: none;
}

.login-box .card-header h1 {
  color: #ffffff;
  font-size: 1.8rem;
  font-weight: 700;
  margin: 0;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.login-box .card-body {
  padding: 28px;
}

/* ========== ç™»å…¥åˆ‡æ›æŒ‰éˆ• ========== */
.login-switch {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 24px;
}

.login-switch button {
  padding: 10px 24px;
  border: 2px solid #e2e8f0;
  background-color: #f8fafc;
  color: #475569;
  cursor: pointer;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  transition:
    background-color 0.2s ease,
    border-color 0.2s ease,
    color 0.2s ease;
}

.login-switch button:hover {
  background-color: #e2e8f0;
  border-color: #cbd5e1;
}

.login-switch button.active {
  background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
  color: #ffffff;
  border-color: #3b82f6;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* ========== è¼¸å…¥æ¬„ä½ ========== */
.login-box .input-group {
  margin-bottom: 16px;
}

.login-box .form-control {
  padding: 12px 16px;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  font-size: 15px;
  transition:
    border-color 0.2s ease,
    box-shadow 0.2s ease;
  background: #f8fafc;
}

.login-box .form-control:focus {
  border-color: #60a5fa;
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
  outline: none;
  background: #ffffff;
}

.login-box .form-control::placeholder {
  color: #94a3b8;
}

/* ========== è¼”åŠ©é€£çµ (è¨»å†Š + å¿˜è¨˜å¯†ç¢¼) ========== */
.helper-links {
  display: flex;
  justify-content: space-between;
  margin-bottom: 16px;
}

.helper-links span {
  font-size: 14px;
  color: #3b82f6;
  cursor: pointer;
  font-weight: 500;
  transition: color 0.2s ease;
}

.helper-links span:hover {
  color: #1d4ed8;
  text-decoration: underline;
}

/* ========== ç™»å…¥æŒ‰éˆ• ========== */
.login-box .btn-primary {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  color: #ffffff;
  cursor: pointer;
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.login-box .btn-primary:hover {
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

.login-box .btn-primary:active {
  transform: translateY(1px);
}

/* ========== å¿˜è¨˜å¯†ç¢¼å°ˆç”¨æ¨£å¼ ========== */
.sub-title {
  text-align: center;
  font-size: 20px;
  color: #333;
  margin-bottom: 15px;
}

.desc-text {
  font-size: 13px;
  color: #64748b;
  text-align: center;
  margin-bottom: 20px;
  line-height: 1.5;
}

.info-text {
  font-size: 14px;
  background-color: #f1f5f9;
  padding: 10px;
  border-radius: 8px;
  color: #475569;
  margin-bottom: 15px;
  text-align: center;
}

.back-link-center {
  margin-top: 20px;
  text-align: center;
  cursor: pointer;
}

.back-link-center span {
  font-size: 14px;
  color: #64748b;
  transition: color 0.2s;
}

.back-link-center:hover span {
  color: #3b82f6;
  text-decoration: underline;
}

/* ========== Google ç™»å…¥èˆ‡è¿”å›é¦–é   ========== */
.back-to-home {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 15px;
  /* èˆ‡ç™»å…¥æŒ‰éˆ•æ‹‰é–‹è·é›¢ */
  padding-top: 10px;
  border-top: 1px inset #f0f0f0; /* åŠ ä¸€æ¢æ·¡æ·¡çš„åˆ†éš”ç·š */
  color: #6c757d;
  /* ç°è‰²ï¼Œä¸æ¶èµ°ç™»å…¥æŒ‰éˆ•çš„ç„¦é» */
  font-size: 14px;
  cursor: pointer;
  transition: color 0.2s;
  gap: 5px;
}

.back-to-home:hover {
  color: #007bff;
  /* æ‡¸æµ®æ™‚è®Šå›è—è‰² */
  text-decoration: underline;
}

/* ç¢ºä¿ el-icon åœ¨æ–‡å­—ä¸­é–“ */
.back-to-home .el-icon {
  font-size: 12px;
}

.google-login-section {
  margin-top: 20px;
}

.divider {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  color: #888;
  font-size: 12px;
}

.divider::before,
.divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: #eee;
}

.divider span {
  padding: 0 10px;
}

.btn-google {
  width: 100%;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background-color: #ffffff;
  border: 1px solid #dadce0;
  border-radius: 4px;
  color: #3c4043;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s;
}

.btn-google img {
  width: 18px;
  height: 18px;
}

.btn-google:hover {
  background-color: #f8f9fa;
  box-shadow:
    0 1px 2px 0 rgba(60, 64, 67, 0.3),
    0 1px 3px 1px rgba(60, 64, 67, 0.15);
}
</style>
</file>

<file path="frontend/src/views/member/MemberCreateView.vue">
<script setup>
/**
 * MemberCreateView.vueï¼šæ–°å¢æœƒå“¡ï¼ˆæ›è£ç¾åŒ–ç‰ˆï¼‰
 */
import { reactive } from 'vue'
import { useRouter } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'

const router = useRouter()

const member = reactive({
  memUsername: '',
  memPassword: '',
  memName: '',
  memEmail: '',
  memPhone: '',
  memInvoice: '',
  memStatus: 1,
  memLevel: 1,
})

// --- æ ¼å¼é©—è­‰é‚è¼¯ (ä¿ç•™åŸæ¨£) ---
const validateForm = () => {
  if (!member.memUsername || !member.memPassword || !member.memName || !member.memEmail || !member.memPhone) {
    return 'é™¤äº†ç™¼ç¥¨è¼‰å…·ï¼Œå…¶é¤˜æ¬„ä½çš†ç‚ºå¿…å¡«'
  }

  const pwdRegex = /^(?=.*[a-zA-Z]).{6,}$/
  if (!pwdRegex.test(member.memPassword)) {
    return 'å¯†ç¢¼éœ€è‡³å°‘ 6 å€‹å­—å…ƒï¼Œä¸¦åŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯'
  }

  const phoneRegex = /^09\d{8}$/
  if (!phoneRegex.test(member.memPhone)) {
    return 'æ‰‹æ©Ÿæ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥ 09 é–‹é ­çš„ 10 ä½æ•¸å­—'
  }

  const emailRegex = /^[^\s@]+@[^\s@]+\.com$/
  if (!emailRegex.test(member.memEmail)) {
    return 'ä¿¡ç®±æ ¼å¼éŒ¯èª¤ï¼Œå¿…é ˆåŒ…å« @ ä¸”çµå°¾ç‚º .com'
  }

  return null
}

const submitCreate = async () => {
  const error = validateForm()
  if (error) {
    await Swal.fire({
      icon: 'warning',
      title: 'æ ¼å¼éŒ¯èª¤',
      text: error,
      confirmButtonColor: '#5b9bd5',
    })
    return
  }

  try {
    const res = await axios.post('http://localhost:8080/api/members', {
      ...member,
      memStatus: 1,
      memLevel: 1,
    })

    await Swal.fire({
      icon: 'success',
      title: 'æ–°å¢æˆåŠŸ',
      text: res.data?.message || 'æœƒå“¡å·²æ–°å¢',
      timer: 1500,
      showConfirmButton: false,
    })

    router.push('/admin/members')
  } catch (err) {
    const msg = err.response?.data?.message || 'æ–°å¢å¤±æ•—'
    await Swal.fire({
      icon: 'error',
      title: 'æ–°å¢å¤±æ•—',
      text: msg,
      confirmButtonColor: '#f56c6c',
    })
  }
}

const goBack = () => {
  router.push('/admin/members')
}
</script>

<template>
  <div class="create-page">
    <div class="form-card">
      <div class="card-header">
        <div class="header-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <h2>æ–°å¢æœƒå“¡</h2>
        <p>å»ºç«‹æ–°çš„ Take@Seat ä½¿ç”¨è€…å¸³è™Ÿ</p>
      </div>

      <el-form @submit.prevent="submitCreate" label-position="top" class="admin-form">
        <el-form-item label="å¸³è™Ÿ" required>
          <el-input
            v-model="member.memUsername"
            placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
            prefix-icon="User"
            autocomplete="new-username"
          />
        </el-form-item>

        <el-form-item label="å¯†ç¢¼" required>
          <el-input
            type="password"
            v-model="member.memPassword"
            placeholder="è‡³å°‘ 6 ç¢¼ä¸”åŒ…å«è‹±æ–‡å­—æ¯"
            prefix-icon="Lock"
            autocomplete="new-password"
            show-password
          />
        </el-form-item>

        <el-form-item label="å§“å" required>
          <el-input
            v-model="member.memName"
            placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å"
            prefix-icon="UserFilled"
          />
        </el-form-item>

        <el-form-item label="ä¿¡ç®±" required>
          <el-input
            v-model="member.memEmail"
            placeholder="example@mail.com"
            prefix-icon="Message"
          />
        </el-form-item>

        <el-form-item label="æ‰‹æ©Ÿ" required>
          <el-input
            v-model="member.memPhone"
            placeholder="09xxxxxxxx"
            maxlength="10"
            prefix-icon="Iphone"
          />
        </el-form-item>

        <el-form-item label="ç™¼ç¥¨è¼‰å…· (é¸å¡«)">
          <el-input
            v-model="member.memInvoice"
            placeholder="ä¾‹ï¼š/ABC1234"
            prefix-icon="Tickets"
          />
        </el-form-item>

        <div class="form-actions">
          <el-button 
            type="primary" 
            size="large" 
            native-type="submit" 
            class="submit-btn"
          >
            <i class="fas fa-check mr-2"></i> ç¢ºèªæ–°å¢
          </el-button>
          
          <el-button 
            size="large" 
            @click="goBack" 
            class="back-btn"
            style="margin-left: 0" 
          >
            <i class="fas fa-arrow-left mr-2"></i> å›æœƒå“¡åˆ—è¡¨
          </el-button>
        </div>
      </el-form>
    </div>
  </div>
</template>

<style scoped>
/* ========== é é¢å®¹å™¨ ========== */
.create-page {
  min-height: 100vh;
  padding: 40px 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ========== è¡¨å–®å¡ç‰‡ ========== */
.form-card {
  width: 100%;
  max-width: 480px;
  background: white;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  animation: slideUp 0.5s ease;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ========== æ¨™é¡Œå€åŸŸ ========== */
.card-header {
  text-align: center;
  margin-bottom: 32px;
}

.header-icon {
  width: 72px;
  height: 72px;
  background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: #3b82f6;
  margin: 0 auto 16px;
}

.card-header h2 {
  margin: 0;
  font-size: 1.6rem;
  font-weight: 700;
  color: #1e3a5f;
}

.card-header p {
  margin: 8px 0 0;
  color: #94a3b8;
  font-size: 0.95rem;
}

/* ========== è¡¨å–®æ¨£å¼ ========== */
.admin-form :deep(.el-form-item__label) {
  font-weight: 600;
  color: #475569;
}

.admin-form :deep(.el-input__wrapper) {
  border-radius: 10px;
  padding: 4px 12px;
  background-color: #f8fafc;
}

/* ========== æŒ‰éˆ•å€åŸŸ ========== */
.form-actions {
  margin-top: 32px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.submit-btn {
  width: 100%;
  height: 48px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border: none;
  color: white;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.35);
}

.back-btn {
  width: 100%;
  height: 48px;
  font-size: 15px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
  background: white;
  color: #64748b;
}

.back-btn:hover {
  border-color: #3b82f6;
  color: #3b82f6;
  background: #f0f7ff;
}

.mr-2 { margin-right: 8px; }

@media (max-width: 520px) {
  .form-card { padding: 24px; }
}
</style>
</file>

<file path="frontend/src/views/member/MemberEditView.vue">
<script setup>
import { ref, onMounted } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'

const router = useRouter()
const route = useRoute()

// ä¿ç•™ä½ åŸæœ¬çš„åˆå§‹çµæ§‹èˆ‡å›å¡«é‚è¼¯
const member = ref({
  memId: '',
  memUsername: '',
  memName: '',
  memEmail: '',
  memPhone: '',
  memPoints: 0,
  memInvoice: ''
})
const newPassword = ref('')
const errorMsg = ref('')
const isSubmitting = ref(false)
const isLoading = ref(true)

const fetchMember = async () => {
  const id = route.params.id
  isLoading.value = true
  try {
    const res = await axios.get(`http://localhost:8080/api/members/find`, {
      params: { memId: id },
    })
    
    const data = res.data
    member.value = {
      ...data,
      memEmail: data.memEmail || data.email || '', 
      memPhone: data.memPhone || data.phone || ''
    }
  } catch (err) {
    errorMsg.value = 'è¼‰å…¥æœƒå“¡è³‡æ–™å¤±æ•—'
    Swal.fire({ icon: 'error', title: 'è¼‰å…¥å¤±æ•—', text: errorMsg.value })
  } finally {
    isLoading.value = false
  }
}

// ä¿ç•™åŸæœ¬çš„é©—è­‰é‚è¼¯
const validateEditForm = () => {
  const m = member.value
  if (!m.memUsername || !m.memName || !m.memEmail || !m.memPhone) {
    return 'åŸºæœ¬è³‡æ–™æ¬„ä½çš†ç‚ºå¿…å¡«'
  }
  if (newPassword.value) {
    const pwdRegex = /^(?=.*[a-zA-Z]).{6,}$/
    if (!pwdRegex.test(newPassword.value)) {
      return 'æ–°å¯†ç¢¼éœ€è‡³å°‘ 6 å€‹å­—å…ƒï¼Œä¸¦åŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯'
    }
  }
  const phoneRegex = /^09\d{8}$/
  if (!phoneRegex.test(m.memPhone)) {
    return 'æ‰‹æ©Ÿæ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥ 09 é–‹é ­çš„ 10 ä½æ•¸å­—'
  }
  const emailRegex = /^[^\s@]+@[^\s@]+\.com$/
  if (!emailRegex.test(m.memEmail)) {
    return 'ä¿¡ç®±æ ¼å¼éŒ¯èª¤ï¼Œå¿…é ˆåŒ…å« @ ä¸”çµå°¾ç‚º .com'
  }
  if (m.memInvoice) {
    const invoiceRegex = /^\/[A-Z0-9]{7}$/
    if (!invoiceRegex.test(m.memInvoice)) {
      return 'è¼‰å…·æ ¼å¼éŒ¯èª¤ï¼è«‹è¼¸å…¥ / é–‹é ­åŠ ä¸Š 7 ç¢¼å¤§å¯«è‹±æ•¸çµ„åˆ'
    }
  }
  return null
}

const submitEdit = async () => {
  if (!member.value) return
  const error = validateEditForm()
  if (error) {
    await Swal.fire({
      icon: 'warning',
      title: 'æ ¼å¼éŒ¯èª¤',
      text: error,
      confirmButtonColor: '#5b9bd5',
    })
    return
  }

  // ä¿ç•™äºŒæ¬¡ç¢ºèªè¦–çª—
  const confirmResult = await Swal.fire({
    title: 'ç¢ºå®šè¦ä¿®æ”¹å—ï¼Ÿ',
    text: "ä¿®æ”¹å¾Œçš„è³‡æ–™å°‡æœƒç«‹å³ç”Ÿæ•ˆï¼",
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#5b9bd5',
    cancelButtonColor: '#909399',
    confirmButtonText: 'ä¿®æ”¹',
    cancelButtonText: 'å–æ¶ˆ'
  })

  if (!confirmResult.isConfirmed) return

  errorMsg.value = ''
  isSubmitting.value = true

  try {
    const payload = {
      ...member.value,
      ...(newPassword.value ? { memPassword: newPassword.value } : {}),
    }
    await axios.post('http://localhost:8080/api/members/update', payload)
    await Swal.fire({
      icon: 'success',
      title: 'ä¿®æ”¹æˆåŠŸ',
      text: 'æœƒå“¡è³‡æ–™å·²æ›´æ–°',
      timer: 1500,
      showConfirmButton: false
    })
    router.push('/admin/members')
  } catch (err) {
    const msg = err?.response?.data?.message || 'ä¿®æ”¹å¤±æ•—'
    await Swal.fire({
      icon: 'error',
      title: 'ä¿®æ”¹å¤±æ•—',
      text: msg,
      confirmButtonColor: '#f56c6c',
    })
  } finally {
    isSubmitting.value = false
  }
}

const goBack = () => router.push('/admin/members')
onMounted(fetchMember)
</script>

<template>
  <div class="edit-page">
    <div class="form-card">
      <div class="card-header">
        <div class="header-icon">
          <i class="fas fa-user-edit"></i>
        </div>
        <h2>ä¿®æ”¹æœƒå“¡è³‡æ–™</h2>
        <p>ç·¨è¼¯ Take@Seat æœƒå“¡å¸³è™Ÿèˆ‡é»æ•¸è³‡è¨Š</p>
      </div>

      <el-alert 
        v-if="errorMsg" 
        :title="errorMsg" 
        type="error" 
        show-icon 
        :closable="false" 
        class="error-alert" 
      />
      
      <div v-if="isLoading" class="loading-state">
        <i class="fas fa-spinner fa-spin loading-icon"></i>
        <p>è³‡æ–™è¼‰å…¥ä¸­...</p>
      </div>

      <el-form v-else @submit.prevent="submitEdit" label-position="top" class="admin-form">
        <input type="hidden" v-model="member.memId" />

        <el-form-item label="å¸³è™Ÿ" required>
          <el-input v-model="member.memUsername" prefix-icon="User" />
        </el-form-item>

        <el-form-item label="æ–°å¯†ç¢¼">
          <el-input
            type="password"
            v-model="newPassword"
            placeholder="è‹¥ä¸ä¿®æ”¹è«‹ç•™ç©º"
            prefix-icon="Lock"
            show-password
          />
          <div class="form-hint">
            <i class="fas fa-info-circle"></i>
            éœ€è‡³å°‘ 6 ç¢¼ä¸¦å«è‹±æ–‡å­—ï¼Œä¸ä¿®æ”¹è«‹ä¿æŒç©ºç™½
          </div>
        </el-form-item>

        <el-form-item label="å§“å" required>
          <el-input v-model="member.memName" prefix-icon="UserFilled" />
        </el-form-item>

        <el-form-item label="ä¿¡ç®±" required>
          <el-input v-model="member.memEmail" prefix-icon="Message" />
        </el-form-item>

        <el-form-item label="é›»è©±" required>
          <el-input v-model="member.memPhone" maxlength="10" prefix-icon="Iphone" />
        </el-form-item>

        <el-form-item label="é»æ•¸">
          <el-input v-model.number="member.memPoints" type="number" prefix-icon="Coin" />
        </el-form-item>

        <el-form-item label="ç™¼ç¥¨è¼‰å…·">
          <el-input v-model="member.memInvoice" placeholder="ä¾‹ï¼š/ABC1234" prefix-icon="Tickets" />
        </el-form-item>

        <div class="form-actions">
          <el-button 
            type="primary" 
            size="large" 
            native-type="submit" 
            class="submit-btn"
            :loading="isSubmitting"
          >
            <i class="fas fa-save mr-2"></i> {{ isSubmitting ? 'ä¿®æ”¹ä¸­...' : 'ç¢ºèªä¿®æ”¹' }}
          </el-button>
          <el-button 
            size="large" 
            @click="goBack" 
            class="back-btn"
            style="margin-left: 0"
          >
            <i class="fas fa-arrow-left mr-2"></i> å›æœƒå“¡åˆ—è¡¨
          </el-button>
        </div>
      </el-form>
    </div>
  </div>
</template>

<style scoped>
/* å¥—ç”¨ç®¡ç†å“¡ä¿®æ”¹é é¢çš„é«˜ç´šæ¨£å¼ */
.edit-page {
  min-height: 100vh;
  padding: 40px 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}

.form-card {
  width: 100%;
  max-width: 480px;
  background: white;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  animation: slideUp 0.5s ease;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.card-header {
  text-align: center;
  margin-bottom: 32px;
}

.header-icon {
  width: 72px;
  height: 72px;
  background: linear-gradient(135deg, #e8f4fc 0%, #d4e8f7 100%);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: #5b9bd5;
  margin: 0 auto 16px;
}

.card-header h2 {
  margin: 0;
  font-size: 1.6rem;
  font-weight: 700;
  color: #303133;
}

.card-header p {
  margin: 8px 0 0;
  color: #909399;
  font-size: 0.95rem;
}

.loading-state {
  text-align: center;
  padding: 40px;
}

.loading-icon {
  font-size: 36px;
  color: #409eff;
  margin-bottom: 16px;
}

.error-alert {
  margin-bottom: 20px;
  border-radius: 10px;
}

.admin-form :deep(.el-form-item__label) {
  font-weight: 600;
  color: #606266;
}

.admin-form :deep(.el-input__wrapper) {
  border-radius: 10px;
  padding: 4px 12px;
}

.form-hint {
  margin-top: 6px;
  font-size: 12px;
  color: #909399;
  display: flex;
  align-items: center;
  gap: 6px;
}

.form-actions {
  margin-top: 32px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.submit-btn {
  width: 100%;
  height: 48px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  background: linear-gradient(135deg, #5b9bd5 0%, #7cb9e8 100%);
  border: none;
  color: white;
  transition: all 0.3s ease;
}

.submit-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(91, 155, 213, 0.35);
}

.back-btn {
  width: 100%;
  height: 48px;
  font-size: 15px;
  border-radius: 12px;
  border: 1px solid #e8ecf1;
  background: transparent;
  color: #606266;
}

.back-btn:hover {
  border-color: #5b9bd5;
  color: #5b9bd5;
  background: rgba(91, 155, 213, 0.05);
}

.mr-2 { margin-right: 8px; }
</style>
</file>

<file path="frontend/src/views/member/AdminHomeView.vue">
<script setup>
/**
 * AdminHomeView.vueï¼šå¾Œå°é¦–é å…¥å£ (Layout é©é…ä¿®æ­£ç‰ˆ)
 * ------------------------------------------------
 * 1. [Fix] æ›´å .content-wrapper -> .dashboard-inner é¿å…èˆ‡ AdminLayout è¡çª
 * 2. [Fix] ç§»é™¤ min-height: 100vhï¼Œæ”¹ç”±å…§å®¹æ’é–‹ï¼Œé©é… AdminLTE çµæ§‹
 * 3. [Fix] ç²’å­ç‰¹æ•ˆæ”¹ç‚º absoluteï¼Œé™åˆ¶åœ¨å…§å®¹å€å¡Šå…§
 * 4. [Layout] æ¨¡çµ„å€å¡Šæ¡ç”¨ Grid åˆ†ç®±è¨­è¨ˆï¼Œç¢ºä¿æ¯å€‹é¡åˆ¥ç¨ç«‹é¡¯ç¤º
 * ------------------------------------------------
 */
import { ref, onMounted, onUnmounted, computed } from 'vue'
import { useRouter } from 'vue-router'
import { useAdminAuthStore } from '@/stores/adminAuth'
import axios from 'axios'

const router = useRouter()
const adminAuthStore = useAdminAuthStore()

const adminName = computed(() => adminAuthStore.admin?.name || 'ç®¡ç†å“¡')

// =======================
// 1. çµ±è¨ˆæ•¸æ“šç‹€æ…‹
// =======================
const stats = ref({
  totalSpots: 0,
  totalSeats: 0,
  maintenanceCount: 0,
  totalMembers: 0,
  activeRentals: 0,
})

const loading = ref(true)
const currentTime = ref('')
const timeInterval = ref(null)

// =======================
// 2. åœ–è¡¨è¨­å®š
// =======================
// (A) ç‡Ÿæ”¶è¶¨å‹¢åœ–
const revenueSeries = ref([])
const revenueOptions = ref({
  chart: {
    type: 'area',
    height: 350,
    toolbar: { show: false },
    fontFamily: 'Helvetica, Arial, sans-serif',
    animations: { enabled: true, easing: 'easeinout', speed: 800 },
    background: 'transparent',
  },
  dataLabels: { enabled: false },
  stroke: { curve: 'smooth', width: 3 },
  xaxis: {
    categories: [],
    axisBorder: { show: false },
    axisTicks: { show: false },
    labels: { style: { colors: '#64748b' } },
  },
  yaxis: { labels: { style: { colors: '#64748b' } } },
  grid: {
    borderColor: '#f1f1f1',
    strokeDashArray: 4,
    padding: { top: 0, right: 0, bottom: 0, left: 10 },
  },
  fill: {
    type: 'gradient',
    gradient: {
      shadeIntensity: 1,
      opacityFrom: 0.6,
      opacityTo: 0.05,
      stops: [0, 90, 100],
    },
  },
  tooltip: { x: { format: 'yyyy-MM-dd' }, theme: 'light' },
  colors: ['#4f46e5'],
})

// (B) ç†±é–€ç«™é»æ’è¡Œ
const spotSeries = ref([])
const spotOptions = ref({
  chart: {
    type: 'bar',
    height: 350,
    toolbar: { show: false },
    fontFamily: 'Helvetica, Arial, sans-serif',
    background: 'transparent',
  },
  plotOptions: {
    bar: {
      borderRadius: 4,
      horizontal: true,
      barHeight: '55%',
      distributed: true,
    },
  },
  dataLabels: { enabled: false },
  xaxis: {
    categories: [],
    labels: { style: { colors: '#64748b' } },
  },
  yaxis: { labels: { style: { colors: '#64748b', fontSize: '13px', fontWeight: 500 } } },
  grid: { show: false },
  colors: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
  legend: { show: false },
})

// =======================
// 3. æ™‚é–“æ›´æ–°é‚è¼¯
// =======================
const updateTime = () => {
  currentTime.value = new Date().toLocaleString('zh-TW', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
  })
}

// =======================
// 4. è³‡æ–™ç²å–èˆ‡è™•ç†
// =======================
const fetchStats = async () => {
  loading.value = true
  try {
    const [spotsRes, seatsRes, membersRes, rentalsRes, ticketsRes] = await Promise.all([
      axios.get('/api/spot/list'),
      axios.get('/api/seats'),
      axios.get('/api/members'),
      axios.get('/api/rent-details/all'),
      axios.get('/api/maintenance/tickets/active'),
    ])

    // åŸºç¤æ•¸æ“š
    stats.value.totalSpots = spotsRes.data?.length || 0
    stats.value.totalSeats = seatsRes.data?.length || 0
    stats.value.maintenanceCount = (ticketsRes.data || []).length
    stats.value.totalMembers = membersRes.data?.length || 0
    stats.value.activeRentals = (rentalsRes.data || []).filter(
      (r) => r.recStatus === 'ç§Ÿå€Ÿä¸­',
    ).length

    // åœ–è¡¨æ•¸æ“šè™•ç†
    const rawRentals = rentalsRes.data || []

    // (A) æ¯æ—¥ç‡Ÿæ”¶
    const dailyMap = {}
    rawRentals.forEach((item) => {
      const dateKey = item.recRentDT2 ? item.recRentDT2.split('T')[0] : 'Unknown'
      const price = item.recPrice || 0
      if (!dailyMap[dateKey]) dailyMap[dateKey] = 0
      dailyMap[dateKey] += price
    })
    const sortedDates = Object.keys(dailyMap).sort()
    const dailyAmounts = sortedDates.map((date) => dailyMap[date])

    revenueOptions.value = { ...revenueOptions.value, xaxis: { categories: sortedDates } }
    revenueSeries.value = [{ name: 'ç•¶æ—¥ç‡Ÿæ”¶', data: dailyAmounts }]

    // (B) ç†±é–€ç«™é»
    const spotCountMap = {}
    rawRentals.forEach((item) => {
      const spotName = item.rentSpotName || 'æœªçŸ¥ç«™é»'
      spotCountMap[spotName] = (spotCountMap[spotName] || 0) + 1
    })
    const sortedSpots = Object.entries(spotCountMap)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5)

    const topSpotNames = sortedSpots.map((entry) => entry[0])
    const topSpotCounts = sortedSpots.map((entry) => entry[1])

    spotOptions.value = { ...spotOptions.value, xaxis: { categories: topSpotNames } }
    spotSeries.value = [{ name: 'ç§Ÿå€Ÿæ¬¡æ•¸', data: topSpotCounts }]
  } catch (error) {
    console.error('çµ±è¨ˆè¼‰å…¥å¤±æ•—:', error)
  } finally {
    loading.value = false
  }
}

// =======================
// 5. æ¨¡çµ„å®šç¾©
// =======================
const moduleGroups = [
  {
    title: 'å ´åœ°èˆ‡åº§ä½ç®¡ç†',
    icon: 'fas fa-building',
    modules: [
      {
        name: 'æ“šé»ç®¡ç†',
        desc: 'ç®¡ç†å„å€åŸŸæ“šé»',
        icon: 'fas fa-map-marker-alt',
        path: '/admin/spot/list',
      },
      { name: 'åº§ä½ç®¡ç†', desc: 'åº§ä½é…ç½®èˆ‡ç‹€æ…‹', icon: 'fas fa-chair', path: '/admin/seat/list' },
      {
        name: 'æ“šé»åˆ†æ',
        desc: 'é—œéµçµ±è¨ˆåœ–è¡¨',
        icon: 'fas fa-chart-line',
        path: '/admin/spot/analyze',
      },
      {
        name: 'èª¿åº¦ä¸­å¿ƒ',
        desc: 'å³æ™‚ç›£æ§èˆ‡èª¿åº¦',
        icon: 'fas fa-broadcast-tower',
        path: '/admin/spot/monitor',
      },
    ],
  },
  {
    title: 'æœƒå“¡èˆ‡æ¬Šé™ç®¡ç†',
    icon: 'fas fa-users-cog',
    modules: [
      { name: 'æœƒå“¡åˆ—è¡¨', desc: 'ä¸€èˆ¬æœƒå“¡è³‡æ–™ç®¡ç†', icon: 'fas fa-users', path: '/admin/members' },
      {
        name: 'ç®¡ç†å“¡åˆ—è¡¨',
        desc: 'å¾Œå°æ¬Šé™è¨­å®š',
        icon: 'fas fa-user-shield',
        path: '/admin/admins',
      },
    ],
  },
  {
    title: 'å•†å®¶èˆ‡å„ªæƒ ç®¡ç†',
    icon: 'fas fa-store',
    modules: [
      {
        name: 'å•†å®¶ç®¡ç†',
        desc: 'åˆä½œå•†å®¶è³‡æ–™',
        icon: 'fas fa-store-alt',
        path: '/admin/merchants',
      },
      {
        name: 'å„ªæƒ åˆ¸ç®¡ç†',
        desc: 'ç™¼æ”¾èˆ‡ç®¡ç†å„ªæƒ åˆ¸',
        icon: 'fas fa-ticket-alt',
        path: '/admin/discounts',
      },
      {
        name: 'å…Œæ›ç´€éŒ„',
        desc: 'é»æ•¸å…Œæ›å ±è¡¨',
        icon: 'fas fa-clipboard-list',
        path: '/admin/redemption-logs',
      },
    ],
  },
  {
    title: 'ç§Ÿå€Ÿèˆ‡è¨‚å–®ç®¡ç†',
    icon: 'fas fa-file-invoice-dollar',
    modules: [
      {
        name: 'çµ±è¨ˆåœ–è¡¨',
        desc: 'ç‡Ÿæ”¶èˆ‡ç§Ÿå€Ÿåˆ†æ',
        icon: 'fas fa-chart-pie',
        path: '/admin/rec-chart',
      },
      { name: 'è¨‚å–®ç®¡ç†', desc: 'æŸ¥è©¢æ­·å²è¨‚å–®', icon: 'fas fa-list-alt', path: '/admin/rec-rent' },
    ],
  },
  {
    title: 'ç¶­è­·èˆ‡å·¥å–®ç®¡ç†',
    icon: 'fas fa-tools',
    modules: [
      {
        name: 'ç¶­è­·äººå“¡ç®¡ç†',
        desc: 'äººå“¡æ’ç­èˆ‡è³‡æ–™',
        icon: 'fas fa-user-cog',
        path: '/admin/staff-list',
      },
      {
        name: 'ç¶­ä¿®å·¥å–®ç®¡ç†',
        desc: 'è¿½è¹¤ç¶­ä¿®é€²åº¦',
        icon: 'fas fa-wrench',
        path: '/admin/mtif-list',
      },
      {
        name: 'å®šæœŸæ’ç¨‹ç®¡ç†',
        desc: 'è‡ªå‹•åŒ–ç¶­è­·æ’ç¨‹',
        icon: 'fas fa-calendar-alt',
        path: '/admin/maintenance/schedule',
      },
    ],
  },
]

// =======================
// 6. ç”Ÿå‘½é€±æœŸ
// =======================
onMounted(() => {
  updateTime()
  timeInterval.value = setInterval(updateTime, 1000)
  fetchStats()
})

onUnmounted(() => {
  if (timeInterval.value) clearInterval(timeInterval.value)
})
</script>

<template>
  <div class="dashboard-container">
    <div class="particles-container">
      <div class="particle" v-for="n in 30" :key="n"></div>
    </div>

    <main class="dashboard-inner fade-in-up">
      <header class="header-section">
        <div class="header-left">
          <h1>{{ adminName }} <span class="wave"></span></h1>
          <p class="subtitle">Take@Seat ç‡Ÿé‹æ§åˆ¶ä¸­å¿ƒ</p>
        </div>
        <div class="header-right">
          <div class="time-pill">
            <span class="pulse-dot"></span>
            {{ currentTime }}
          </div>
        </div>
      </header>

      <section class="stats-section">
        <div class="stat-card">
          <div class="icon-circle blue-bg"><i class="fas fa-map-marker-alt"></i></div>
          <div class="stat-content">
            <span class="stat-num">{{ loading ? '...' : stats.totalSpots }}</span>
            <span class="stat-label">ç‡Ÿé‹æ“šé»</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="icon-circle purple-bg"><i class="fas fa-chair"></i></div>
          <div class="stat-content">
            <span class="stat-num">{{ loading ? '...' : stats.totalSeats }}</span>
            <span class="stat-label">è³‡ç”¢ç¸½æ•¸</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="icon-circle red-bg"><i class="fas fa-tools"></i></div>
          <div class="stat-content">
            <span class="stat-num">{{ loading ? '...' : stats.maintenanceCount }}</span>
            <span class="stat-label">ç¶­è­·æ¡ˆé‡</span>
          </div>
          <div class="alert-dot" v-if="stats.maintenanceCount > 0"></div>
        </div>

        <div class="stat-card">
          <div class="icon-circle green-bg"><i class="fas fa-broadcast-tower"></i></div>
          <div class="stat-content">
            <span class="stat-num">{{ loading ? '...' : stats.activeRentals }}</span>
            <span class="stat-label">å³æ™‚ç§Ÿå€Ÿ</span>
          </div>
        </div>
      </section>

      <section class="charts-section">
        <div class="chart-wrapper">
          <div class="section-header">
            <h3><i class="fas fa-chart-area"></i> ç‡Ÿæ”¶è¶¨å‹¢åˆ†æ</h3>
            <span class="badge-soft">è¿‘ 7 æ—¥</span>
          </div>
          <apexchart
            type="area"
            height="350"
            :options="revenueOptions"
            :series="revenueSeries"
          ></apexchart>
        </div>

        <div class="chart-wrapper">
          <div class="section-header">
            <h3><i class="fas fa-chart-bar"></i> ç†±é–€ç«™é»æ’è¡Œ</h3>
            <span class="badge-soft">Top 5</span>
          </div>
          <apexchart
            type="bar"
            height="350"
            :options="spotOptions"
            :series="spotSeries"
          ></apexchart>
        </div>
      </section>

      <section class="modules-section">
        <div v-for="(group, gIndex) in moduleGroups" :key="gIndex" class="module-group-box">
          <div class="group-header">
            <i :class="group.icon"></i>
            <span>{{ group.title }}</span>
          </div>

          <div class="module-grid">
            <div
              v-for="(mod, mIndex) in group.modules"
              :key="mIndex"
              class="module-btn"
              @click="router.push(mod.path)"
            >
              <div class="mod-icon">
                <i :class="mod.icon"></i>
              </div>
              <div class="mod-info">
                <h4>{{ mod.name }}</h4>
                <span>{{ mod.desc }}</span>
              </div>
              <i class="fas fa-chevron-right arrow-icon"></i>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</template>

<style scoped>
/* =========================================
   1. Layout é©é…ä¿®æ­£
   ========================================= */
.dashboard-container {
  /* ğŸ”¥ ç§»é™¤ min-height: 100vhï¼Œå› ç‚ºå¤–å±¤ AdminLayout å·²ç¶“æœ‰é«˜åº¦ */
  width: 100%;
  background-color: #f8fafc; /* ç¢ºä¿æœ‰åº•è‰² */
  color: #0f172a;
  position: relative;
  /* çµ¦ä¸€é»å…§è·ï¼Œè®“å…§å®¹ä¸è¦è²¼æ­»é‚Šç·£ */
  padding: 1.5rem;
  overflow: hidden; /* é˜²æ­¢å…§éƒ¨ç²’å­æº¢å‡º */
}

/* âœ… æ”¹åç‚º dashboard-innerï¼Œä¸å†èˆ‡ AdminLTE çš„ content-wrapper è¡çª */
.dashboard-inner {
  position: relative;
  z-index: 2;
  width: 100%;
  margin: 0;
  padding: 0;
}

/* =========================================
   2. ç²’å­ç‰¹æ•ˆ (æ”¹ç‚º absolute)
   ========================================= */
.particles-container {
  position: absolute; /* ğŸ”¥ æ”¹ç‚º absoluteï¼Œåªä½”æ»¿ dashboard-container */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}

.particle {
  position: absolute;
  width: 6px;
  height: 6px;
  background: rgba(59, 130, 246, 0.4);
  border-radius: 50%;
  animation: float 20s infinite linear;
  opacity: 0.6;
}

.particle:nth-child(even) {
  background: rgba(16, 185, 129, 0.3);
  width: 8px;
  height: 8px;
  animation-duration: 25s;
}
.particle:nth-child(3n) {
  background: rgba(245, 158, 11, 0.3);
  width: 4px;
  height: 4px;
  animation-duration: 18s;
}

/* éš¨æ©Ÿåˆ†ä½ˆ */
.particle:nth-child(1) {
  top: 10%;
  left: 5%;
}
.particle:nth-child(2) {
  top: 20%;
  left: 85%;
}
.particle:nth-child(3) {
  top: 80%;
  left: 15%;
}
.particle:nth-child(4) {
  top: 50%;
  left: 50%;
}
.particle:nth-child(5) {
  top: 30%;
  left: 10%;
}
.particle:nth-child(6) {
  top: 60%;
  left: 90%;
}
/* ...æ›´å¤šçœç•¥ */

@keyframes float {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 0.3;
  }
  50% {
    transform: translateY(-100px) rotate(180deg);
    opacity: 0.8;
  }
  100% {
    transform: translateY(0) rotate(360deg);
    opacity: 0.3;
  }
}

/* =========================================
   3. UI å…ƒä»¶
   ========================================= */
.header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.header-left h1 {
  font-size: 1.75rem;
  font-weight: 800;
  color: #1e293b;
  margin: 0;
}
.subtitle {
  color: #64748b;
  margin-top: 0.25rem;
  font-size: 0.95rem;
}
.time-pill {
  background: white;
  padding: 0.6rem 1.2rem;
  border-radius: 99px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  color: #475569;
  font-size: 0.9rem;
}
.pulse-dot {
  width: 8px;
  height: 8px;
  background: #22c55e;
  border-radius: 50%;
  box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
  animation: pulse 2s infinite;
}

/* çµ±è¨ˆå¡ç‰‡ Grid */
.stats-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow:
    0 1px 3px 0 rgba(0, 0, 0, 0.05),
    0 1px 2px -1px rgba(0, 0, 0, 0.03);
  display: flex;
  align-items: center;
  gap: 1.25rem;
  transition:
    transform 0.2s,
    box-shadow 0.2s;
  position: relative;
}
.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.icon-circle {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  flex-shrink: 0;
}
.blue-bg {
  background: #eff6ff;
  color: #3b82f6;
}
.purple-bg {
  background: #f5f3ff;
  color: #8b5cf6;
}
.red-bg {
  background: #fef2f2;
  color: #ef4444;
}
.green-bg {
  background: #f0fdf4;
  color: #22c55e;
}

.stat-content {
  display: flex;
  flex-direction: column;
}
.stat-num {
  font-size: 1.8rem;
  font-weight: 800;
  color: #0f172a;
  line-height: 1.1;
}
.stat-label {
  font-size: 0.9rem;
  color: #64748b;
  margin-top: 2px;
}
.alert-dot {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 8px;
  height: 8px;
  background: #ef4444;
  border-radius: 50%;
  animation: pulse 1s infinite;
}

/* åœ–è¡¨ Grid */
.charts-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.chart-wrapper {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow:
    0 1px 3px 0 rgba(0, 0, 0, 0.05),
    0 1px 2px -1px rgba(0, 0, 0, 0.03);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}
.section-header h3 {
  font-size: 1.1rem;
  font-weight: 700;
  color: #334155;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.badge-soft {
  background: #f1f5f9;
  color: #64748b;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

/* =========================================
   4. æ¨¡çµ„å€ - åˆ†ç®±ä½ˆå±€ (Modules)
   ========================================= */
.modules-section {
  display: grid;
  /* ğŸ”¥ [é—œéµ] å¤§è¢å¹•é›™æ¬„ï¼Œä¸­è¢å¹•å–®æ¬„ */
  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
  gap: 1.5rem;
}

/* é€™æ˜¯æ‚¨è¦çš„ã€Œç¨ç«‹ Boxã€ */
.module-group-box {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow:
    0 1px 3px 0 rgba(0, 0, 0, 0.05),
    0 1px 2px -1px rgba(0, 0, 0, 0.03);
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.group-header {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  font-size: 1.1rem;
  font-weight: 700;
  color: #334155;
  padding-bottom: 0.8rem;
  border-bottom: 1px solid #f1f5f9;
}
.group-header i {
  color: #3b82f6;
  font-size: 1.2rem;
}

/* æŒ‰éˆ• Grid */
.module-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
}

.module-btn {
  background: #f8fafc;
  border-radius: 10px;
  padding: 1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.2s;
  border: 1px solid transparent;
}
.module-btn:hover {
  background: white;
  border-color: #3b82f6;
  box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
  transform: translateY(-2px);
}

.mod-icon {
  width: 40px;
  height: 40px;
  background: white;
  color: #64748b;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  transition: 0.2s;
}
.module-btn:hover .mod-icon {
  background: #3b82f6;
  color: white;
}

.mod-info {
  flex: 1;
}
.mod-info h4 {
  margin: 0;
  font-size: 0.95rem;
  font-weight: 600;
  color: #1e293b;
}
.mod-info span {
  font-size: 0.75rem;
  color: #94a3b8;
  display: block;
  margin-top: 2px;
}

.arrow-icon {
  font-size: 0.8rem;
  color: #cbd5e1;
  transition: 0.2s;
}
.module-btn:hover .arrow-icon {
  color: #3b82f6;
  transform: translateX(3px);
}

/* å‹•ç•« */
.fade-in-up {
  animation: fadeInUp 0.6s ease-out forwards;
  opacity: 0;
  transform: translateY(15px);
}
@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
@keyframes pulse {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    opacity: 1;
  }
}
@keyframes wave-animation {
  0%,
  100% {
    transform: rotate(0deg);
  }
  50% {
    transform: rotate(15deg);
  }
}
.wave {
  display: inline-block;
  animation: wave-animation 2.5s infinite;
  transform-origin: 70% 70%;
}

/* RWD */
@media (max-width: 768px) {
  .charts-section {
    grid-template-columns: 1fr;
  }
  .modules-section {
    grid-template-columns: 1fr;
  }
}
</style>
</file>

<file path="frontend/src/views/member/AdminListView.vue">
<script setup>
import { ref, onMounted, computed } from 'vue'
import { useRouter } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'
import { useAdminAuthStore } from '@/stores/adminAuth'

const router = useRouter()
const admins = ref([])
const keyword = ref('')
const loading = ref(false)
const authStore = useAdminAuthStore()

const showRoleModal = ref(false)
const adminToEditRole = ref(null)
const selectedRole = ref(1)

// --- åˆ†é æ§åˆ¶ ---
const currentPage = ref(1)
const pageSize = 5

// --- çµ±è¨ˆæ•¸æ“šé‚è¼¯ --- 
const totalAdmins = computed(() => 
  admins.value.filter(a => a.admStatus === 1).length
)
const superAdmins = computed(() => 
  admins.value.filter(a => a.admRole === 9 && a.admStatus === 1).length
)
const normalAdmins = computed(() => 
  admins.value.filter(a => a.admRole === 1 && a.admStatus === 1).length
)

// --- ç‹€æ…‹åˆ‡æ›èˆ‡åœæ¬Šå½ˆçª— ---
const filterStatus = ref(1) // 1: å•Ÿç”¨, 0: åœç”¨
const showBanModal = ref(false)
const banReason = ref('')
const adminToBan = ref(null)

// å–å¾—ç®¡ç†å“¡
const fetchAdmins = async () => {
  loading.value = true
  try {
    const res = await axios.get('http://localhost:8080/admins')
    admins.value = res.data
    currentPage.value = 1
  } catch (error) {
    Swal.fire({
      icon: 'error',
      title: 'è¼‰å…¥å¤±æ•—',
      text: 'å–å¾—ç®¡ç†å“¡è³‡æ–™å¤±æ•—',
      confirmButtonColor: '#ff4d4f'
    })
  } finally {
    loading.value = false
  }
}

// éæ¿¾èˆ‡åˆ†é  (ç‹€æ…‹éæ¿¾)
const filteredAdmins = computed(() => {
  return admins.value.filter(a => a.admStatus === filterStatus.value)
})

const paginatedAdmins = computed(() => {
  const start = (currentPage.value - 1) * pageSize
  return filteredAdmins.value.slice(start, start + pageSize)
})

const totalPages = computed(() => {
  return Math.ceil(filteredAdmins.value.length / pageSize) || 1
})

// æ¨¡ç³Šæœå°‹
const searchAdmins = async () => {
  if (!keyword.value.trim()) {
    fetchAdmins()
    return
  }
  loading.value = true
  try {
    const res = await axios.get('http://localhost:8080/admins/search', {
      params: { keyword: keyword.value.trim() }
    })
    
    if (res.data.length === 0) {
      Swal.fire({
        icon: 'warning',
        title: 'æ‰¾ä¸åˆ°è³‡æ–™',
        text: `æ‰¾ä¸åˆ°èˆ‡ã€Œ${keyword.value}ã€ç›¸é—œçš„ç®¡ç†å“¡`,
        confirmButtonColor: '#f39c12'
      })
    } else {
      admins.value = res.data
      currentPage.value = 1
      Swal.fire({
        icon: 'success',
        title: 'æœå°‹æˆåŠŸ',
        text: `æ‰¾åˆ° ${res.data.length} ç­†ç¬¦åˆçš„ç®¡ç†å“¡è³‡æ–™`,
        timer: 1500,
        showConfirmButton: false
      })
    }
  } catch (error) {
    Swal.fire({ 
      icon: 'error', 
      title: 'æœå°‹ç™¼ç”ŸéŒ¯èª¤' 
    })
  } finally {
    loading.value = false
  }
}


// --- æ¬Šé™æª¢æŸ¥é‚è¼¯ ---
const checkPermission = (actionCallback) => {
  const role = authStore.admin?.admRole || authStore.admin?.role;
  if (Number(role) === 9) {
    actionCallback();
  } else {
    Swal.fire({
      icon: 'lock',
      title: 'æ¬Šé™ä¸è¶³',
      text: 'æ‚¨ç›®å‰æ˜¯ä¸€èˆ¬ç®¡ç†å“¡ï¼Œç„¡æ³•åŸ·è¡Œæ­¤æ“ä½œã€‚',
      confirmButtonColor: '#ff4d4f'
    });
  }
};

// åœæ¬Šæ“ä½œ
const openBanModal = (admin) => {
  adminToBan.value = admin
  banReason.value = ''
  showBanModal.value = true
}

const confirmBanAdmin = async () => {
  if (!banReason.value.trim()) {
    Swal.fire({ icon: 'warning', title: 'è«‹è¼¸å…¥åŸå› ', confirmButtonColor: '#f39c12' })
    return
  }
  try {
    // å‡è¨­å¾Œç«¯ API ç‚º /admins/banï¼Œä¸¦å°‡ç‹€æ…‹æ”¹ç‚º 0
    await axios.post('http://localhost:8080/admins/ban', {
      admId: adminToBan.value.admId,
      reason: banReason.value
    })
    showBanModal.value = false
    Swal.fire({ icon: 'success', title: 'è©²ç®¡ç†å“¡å·²åœè·', timer: 1500, showConfirmButton: false })
    fetchAdmins()
  } catch (error) {
    Swal.fire({ icon: 'error', title: 'æ“ä½œå¤±æ•—' })
  }
}

// æ¢å¾©å•Ÿç”¨
const activateAdmin = async (admin) => {
  const result = await Swal.fire({
    title: 'ç¢ºå®šè¦é‡æ–°å•Ÿç”¨å—ï¼Ÿ',
    text: `å°‡æ¢å¾©ç®¡ç†å“¡ï¼š${admin.admName} çš„å­˜å–æ¬Šé™`,
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#52c41a',
    cancelButtonColor: '#8c8c8c',
    confirmButtonText: 'ç¢ºå®šå•Ÿç”¨',
    cancelButtonText: 'å–æ¶ˆ'
  })

  if (result.isConfirmed) {
    try {
      await axios.post('http://localhost:8080/admins/activate', { admId: admin.admId })
      Swal.fire({ icon: 'success', title: 'å·²æ¢å¾©å•Ÿç”¨', timer: 1500, showConfirmButton: false })
      fetchAdmins()
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'æ¢å¾©å¤±æ•—' })
    }
  }
}

const formatDate = (dt) => {
  if (!dt) return ''
  return dt.substring(0, 10).replace(/-/g, '/')
}

const getAvatar = (id) => {
  if (id >= 1 && id <= 10) {
    const fileName = String(id).padStart(2, '0')
    return `/admin/${fileName}.jpg`
  }
  return '/admin/default.png'
}

// é–‹å•Ÿå½ˆçª—
const openRoleModal = (admin) => {
  adminToEditRole.value = admin
  selectedRole.value = admin.admRole
  showRoleModal.value = true
}

// å„²å­˜è®Šæ›´ä¸¦è·³å‡º SweetAlert ç¢ºèª
const handleUpdateRole = async () => {
  const result = await Swal.fire({
    title: 'ç¢ºå®šè¦è®Šæ›´æ¬Šé™å—ï¼Ÿ',
    text: `å°‡ç®¡ç†å“¡ã€Œ${adminToEditRole.value.admName}ã€çš„è§’è‰²è®Šæ›´ç‚ºï¼š${selectedRole.value === 9 ? 'è¶…ç´šç®¡ç†å“¡' : 'ä¸€èˆ¬ç®¡ç†å“¡'}`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#1890ff',
    cancelButtonColor: '#8c8c8c',
    confirmButtonText: 'ç¢ºå®šæ›´æ–°',
    cancelButtonText: 'å–æ¶ˆ'
  })

  if (result.isConfirmed) {
    try {
      await axios.post(`http://localhost:8080/admins/${adminToEditRole.value.admId}/role`, {
        admRole: selectedRole.value
      })
      showRoleModal.value = false
      Swal.fire({ icon: 'success', title: 'æ¬Šé™å·²æ›´æ–°', timer: 1500, showConfirmButton: false })
      fetchAdmins() // é‡æ–°æ•´ç†åˆ—è¡¨
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'æ›´æ–°å¤±æ•—' })
    }
  }
}

onMounted(fetchAdmins)
</script>

<template>
  <div class="admin-main-container">
      <div class="header-info-card">
        <div class="header-icon">
          <i class="fas fa-user-shield"></i>
        </div>
        <div class="header-content">
          <h2>ç®¡ç†å“¡åˆ—è¡¨</h2>
          <p>ç®¡ç†ç³»çµ±ç®¡ç†å“¡å¸³è™Ÿèˆ‡æ¬Šé™</p>
        </div>
      </div>

      <div class="statistics-row">
        <div class="stat-item blue-left">
          <div class="stat-icon-box bg-blue-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-data">
            <div class="stat-value">{{ totalAdmins }}</div>
            <div class="stat-label">ç®¡ç†å“¡ç¸½æ•¸</div>
          </div>
        </div>
        <div class="stat-item red-left">
          <div class="stat-icon-box bg-red-icon">
            <i class="fas fa-crown"></i>
          </div>
          <div class="stat-data">
            <div class="stat-value">{{ superAdmins }}</div>
            <div class="stat-label">è¶…ç´šç®¡ç†å“¡</div>
          </div>
        </div>
        <div class="stat-item green-left">
          <div class="stat-icon-box bg-green-icon">
            <i class="fas fa-user-tie"></i>
          </div>
          <div class="stat-data">
            <div class="stat-value">{{ normalAdmins }}</div>
            <div class="stat-label">ä¸€èˆ¬ç®¡ç†å“¡</div>
          </div>
        </div>
      </div>

    <div class="search-filter-bar">
      <div class="search-input-group">
        <div class="icon-input-wrap">
          <i class="fas fa-search"></i>
          <input
            v-model="keyword"
            type="text"
            placeholder="æœå°‹å¸³è™Ÿ / å§“å / Email"
            @keyup.enter="searchAdmins"
          />
        </div>
        <button class="btn-action-search" @click="searchAdmins">
          <i class="fas fa-search"></i> æœå°‹
        </button>
        <button class="btn-action-all" @click="fetchAdmins">
          <i class="fas fa-sync-alt"></i> é¡¯ç¤ºå…¨éƒ¨
        </button>
      </div>

      <div class="action-right-group">
        <div class="status-toggle-group">
          <button 
            class="toggle-btn" 
            :class="{ active: filterStatus === 1 }" 
            @click="filterStatus = 1"
          >å•Ÿç”¨å“¡å·¥</button>
          <button 
            class="toggle-btn" 
            :class="{ active: filterStatus === 0 }" 
            @click="filterStatus = 0"
          >åœè·å“¡å·¥</button>
        </div>
        <button class="btn-add-admin" @click="checkPermission(() => router.push('/admin/admins/create'))">
          <i class="fas fa-plus"></i> æ–°å¢ç®¡ç†å“¡
        </button>
      </div>
    </div>

    <div class="table-wrapper-card">
      <table class="data-list-table">
        <thead>
          <tr>
            <th class="col-w-id">ID</th>
            <th class="col-w-info">ç®¡ç†å“¡è³‡è¨Š</th>
            <th class="col-w-email">Email</th>
            <th class="col-w-role">æ¬Šé™</th>
            <th class="col-w-date">åˆ°è·æ—¥</th>
            <th class="col-w-date">{{ filterStatus === 1 ? 'æ›´æ–°æ™‚é–“' : 'åœè·æ—¥' }}</th>
            <th class="col-w-btn">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="a in paginatedAdmins" :key="a.admId">
            <td>{{ a.admId }}</td>
            <td class="align-left">
              <div class="user-info-flex">
                <div class="avatar-box">
                  <img :src="getAvatar(a.admId)" />
                </div>
                <div class="name-account-stack">
                  <span class="full-name">{{ a.admName }}</span>
                  <span class="account-tag">@{{ a.admUsername }}</span>
                </div>
              </div>
            </td>
            <td class="align-left">{{ a.admEmail }}</td>
            <td>
              <span 
                class="role-badge" 
                :class="a.admRole === 9 ? 'role-super' : 'role-normal'"
                @click="checkPermission(() => openRoleModal(a))" 
                style="cursor: pointer;"
              >
                {{ a.admRole === 9 ? 'è¶…ç´šç®¡ç†å“¡' : 'ä¸€èˆ¬ç®¡ç†å“¡' }}
                <i class="fas fa-edit" style="font-size: 10px; margin-left: 4px;"></i>
              </span>
            </td>
            <td>{{ formatDate(a.createdAt) }}</td>
            <td>{{ formatDate(a.updatedAt) }}</td>
            <td>
              <div class="op-button-group">
                <template v-if="filterStatus === 1">
                  <button class="btn-op-edit" @click="checkPermission(() => router.push(`/admin/admins/edit/${a.admId}`))">ä¿®æ”¹</button>
                  <button class="btn-op-stop" @click="checkPermission(() => openBanModal(a))">åœè·</button>
                </template>
                <template v-else>
                  <button class="btn-box-active" @click="checkPermission(() => activateAdmin(a))">å•Ÿç”¨</button>
                </template>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="page-control-footer" v-if="filteredAdmins.length > pageSize">
      <button class="page-nav-btn" :disabled="currentPage === 1" @click="currentPage--">ä¸Šä¸€é </button>
      <span class="page-current-info">ç¬¬ {{ currentPage }} / {{ totalPages }} é </span>
      <button class="page-nav-btn" :disabled="currentPage === totalPages" @click="currentPage++">ä¸‹ä¸€é </button>
    </div>

    <div v-if="showBanModal" class="modal-overlay" @click.self="showBanModal = false">
      <div class="ban-card">
        <div class="ban-header">
          <span>ç®¡ç†å“¡åœè·è™•ç†</span>
          <button class="close-x" @click="showBanModal = false">&times;</button>
        </div>
        <div class="ban-body">
          <label>åœè·åŸå›  <span class="required">*</span></label>
          <textarea v-model="banReason" placeholder="è«‹è©³ç´°è¼¸å…¥åœè·åŸå› ..."></textarea>
          <div class="ban-warning">
            <i class="fas fa-exclamation-triangle"></i> æ³¨æ„ï¼šåœè·å¾Œè©²å¸³è™Ÿå°‡ç„¡æ³•ç™»å…¥å¾Œå°ç³»çµ±ã€‚
          </div>
        </div>
        <div class="ban-footer">
          <button class="btn-close-modal" @click="showBanModal = false">å–æ¶ˆ</button>
          <button class="btn-confirm-ban" @click="confirmBanAdmin">ç¢ºèªåœè·</button>
        </div>
      </div>
    </div>
  </div>
  <div v-if="showRoleModal" class="modal-overlay" @click.self="showRoleModal = false">
    <div class="ban-card" style="width: 350px;"> <div class="ban-header" style="background: #1890ff;">
        <span>ç·¨è¼¯ {{ adminToEditRole.admName }} çš„è·ä½</span>
        <button class="close-x" @click="showRoleModal = false">&times;</button>
      </div>
      <div class="ban-body">
        <p style="color: #909399; font-size: 14px; margin-bottom: 15px;">è«‹å‹¾é¸è¦æŒ‡æ´¾çµ¦æ­¤å“¡å·¥çš„è·ä½ï¼š</p>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" v-model="selectedRole" :value="9"> è¶…ç´šç®¡ç†å“¡ (ADMIN)
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" v-model="selectedRole" :value="1"> ä¸€èˆ¬ç®¡ç†å“¡ (EMPLOYEE)
          </label>
        </div>
      </div>
      <div class="ban-footer">
        <button class="btn-close-modal" @click="showRoleModal = false">å–æ¶ˆ</button>
        <button class="btn-confirm-ban" style="background: #1890ff;" @click="handleUpdateRole">å„²å­˜è®Šæ›´</button>
      </div>
    </div>
  </div>
</template>

<style scoped>
.admin-main-container {
  padding: 24px;
  background-color: #f5f7fa;
  min-height: 100vh;
}

.header-info-card {
  display: flex;
  align-items: center;
  gap: 16px;
  background-color: #ffffff;
  padding: 20px 24px;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  margin-bottom: 24px;
}

.header-icon {
  width: 56px;
  height: 56px;
  background-color: #e8f4ff;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: #1890ff;
}

.header-content h2 {
  margin: 0;
  font-size: 22px;
  color: #303133;
}

.header-content p {
  margin: 4px 0 0 0;
  color: #909399;
  font-size: 14px;
}

/* çµ±è¨ˆå¡ç‰‡å®¹å™¨ï¼šæ§åˆ¶ä¸‰æ¬„ç­‰å¯¬ */
.statistics-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 24px;
}

/* å–®å€‹çµ±è¨ˆé …ç›® */
.stat-item {
  background-color: #ffffff;
  border-radius: 16px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  border-left-width: 5px;
  border-left-style: solid;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.stat-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
}

/* å·¦å´é‚Šæ¡†é¡è‰² */
.blue-left { 
  border-left-color: #1890ff; 
}

.red-left { 
  border-left-color: #ff4d4f; 
}

.green-left { 
  border-left-color: #52c41a; 
}

.stat-icon-box {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ffffff;
  font-size: 20px;
}

.bg-blue-icon { 
  background-color: #1890ff; 
}

.bg-red-icon { 
  background-color: #ff4d4f; 
}

.bg-green-icon { 
  background-color: #52c41a; 
}

.stat-value {
  font-size: 26px;
  font-weight: 700;
  color: #303133;
}

.search-filter-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #ffffff;
  padding: 16px 20px;
  border-radius: 12px;
  margin-bottom: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.search-input-group {
  display: flex;
  gap: 12px;
}

.icon-input-wrap {
  position: relative;
}

.icon-input-wrap i {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #c0c4cc;
}

.icon-input-wrap input {
  padding: 10px 12px 10px 36px;
  border: 1px solid #dcdfe6;
  border-radius: 8px;
  width: 300px;
}

.action-right-group {
  display: flex;
  align-items: center;
  gap: 16px;
}

.status-toggle-group {
  display: flex;
  border: 1px solid #1890ff;
  border-radius: 8px;
  overflow: hidden;
}

.toggle-btn {
  padding: 8px 16px;
  border: none;
  background: white;
  color: #1890ff;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s;
}

.toggle-btn.active {
  background: #1890ff;
  color: white;
}

.btn-action-search,
.btn-action-all,
.btn-add-admin,
.btn-op-edit,
.btn-op-stop,
.btn-box-active,
.page-nav-btn {
  transition: all 0.2s ease;
  cursor: pointer;
  outline: none;
}

.btn-action-search:hover,
.btn-action-all:hover,
.btn-add-admin:hover,
.btn-op-edit:hover,
.btn-op-stop:hover,
.btn-box-active:hover,
.page-nav-btn:hover:not(:disabled), 
.role-badge:hover{
  filter: brightness(1.1);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn-action-search:active,
.btn-add-admin:active,
.btn-op-stop:active {
  transform: scale(0.95);
}

.btn-add-admin {
  background-color: #52c41a;
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
}

.btn-action-search {
  background-color: #1890ff;
  color: white;
  border: none;
  padding: 0 20px;
  border-radius: 8px;
}

.btn-action-all {
  background-color: #52c41a;
  color: white;
  border: none;
  padding: 0 20px;
  border-radius: 8px;
}

.table-wrapper-card {
  background-color: #ffffff;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.data-list-table {
  width: 100%;
  border-collapse: collapse;
}

.data-list-table th {
  background-color: #f8f9fb;
  padding: 16px;
  color: #606266;
  border-bottom: 1px solid #ebeef5;
}

.data-list-table td {
  padding: 16px;
  text-align: left;
  border-bottom: 1px solid #ebeef5;
}

.user-info-flex {
  display: flex;
  align-items: center;
  gap: 12px;
}

.avatar-box img {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  object-fit: cover;
}

.name-account-stack {
  display: flex;
  flex-direction: column;
}

.full-name {
  font-weight: 600;
}

.account-tag {
  font-size: 12px;
  color: #909399;
}

.role-badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  color: white;
  transition: all 0.2s ease;
  cursor: pointer;
}

.role-super {
  background: linear-gradient(135deg, #f56c6c 0%, #ff8e8e 100%);
}

.role-normal {
  background: linear-gradient(135deg, #409eff 0%, #79bbff 100%);
}

.op-button-group {
  display: flex;
  gap: 8px;
}

.btn-op-edit {
  background-color: #1890ff;
  color: white;
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
}

.btn-op-stop {
  background-color: #ff4d4f;
  color: white;
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
}

.btn-box-active {
  background-color: #52c41a;
  color: white;
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.ban-card {
  background: white;
  width: 450px;
  border-radius: 12px;
  overflow: hidden;
}

.ban-header {
  background: #f39c12;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  color: white;
  font-weight: bold;
}

.ban-body {
  padding: 20px;
}

.ban-body textarea {
  width: 100%;
  height: 120px;
  margin-top: 10px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  resize: none;
}

.ban-warning {
  margin-top: 15px;
  background: #fff9db;
  padding: 10px;
  border-radius: 4px;
  font-size: 13px;
  color: #856404;
}

.ban-footer {
  padding: 15px 20px;
  text-align: right;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.btn-confirm-ban {
  background: #f44336;
  color: white;
  border: none;
  padding: 8px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-confirm-ban:hover {
  background: #d32f2f;
  transform: translateY(-1px);
}

.btn-close-modal {
  padding: 8px 20px;
  background: #909399;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-close-modal:hover {
  background: #a6a9ad;
  transform: translateY(-1px);
}

.close-x {
  border: none;
  background: none;
  font-size: 24px;
  cursor: pointer;
  color: #333;
  transition: all 0.2s;
}

.close-x:hover {
  color: #f56c6c;
  transform: rotate(90deg);
}

.required {
  color: red;
}

.page-control-footer {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 16px;
  margin-top: 24px;
}

.page-nav-btn {
  padding: 8px 16px;
  background-color: #ffffff;
  border: 1px solid #dcdfe6;
  border-radius: 8px;
}
</style>
</file>

<file path="frontend/src/views/member/MemberProfileView.vue">
<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

import { useMemberAuthStore } from '@/stores/memberAuth'

import RecRentUserRecord from '@/components/rec/RecRentUserRecord.vue'

import Swal from 'sweetalert2'

const memberAuth = useMemberAuthStore()
const member = ref(null)
const form = ref({})
const isEdit = ref(false)
const errorMsg = ref('')

// ç§Ÿå€Ÿç‹€æ…‹ç›¸é—œ
const activeRent = ref(null) // é€²è¡Œä¸­çš„ç§Ÿå€Ÿè¨‚å–®
const rentSpotName = ref('') // ç§Ÿå€Ÿç«™é»çš„åç¨±
const isLoadingRentStatus = ref(true) // ç§Ÿå€Ÿç‹€æ…‹çš„è®€å–ç‹€æ…‹

// [æ–°å¢] æ§åˆ¶æ­·å²ç´€éŒ„é¡¯ç¤º
const showHistory = ref(false)
const toggleHistory = () => {
  showHistory.value = !showHistory.value
}

const originForm = ref({})

const fetchProfile = async () => {
  try {
    const res = await axios.get('http://localhost:8080/member/profile', {
      withCredentials: true,
    })

    const m = res.data
    member.value = m

    // ä¸€å®šè¦ trimï¼Œé¿å…ç©ºç™½ bug
    form.value = {
      memName: m.memName?.trim() || '',
      memPhone: m.memPhone?.trim() || '',
      memEmail: m.memEmail?.trim() || '',
      memInvoice: m.memInvoice?.trim() || '',
    }
    memberAuth.setMemberLogin(m) // æ›´æ–° Pinia store

    // å–å¾—å€‹äººè³‡æ–™å¾Œï¼Œæ¥è‘—å–å¾—ç§Ÿå€Ÿç‹€æ…‹
    await fetchRentalStatus()
  } catch (e) {
    errorMsg.value = 'å°šæœªç™»å…¥'
  }
}

// æŸ¥è©¢ç§Ÿå€Ÿç‹€æ…‹
const fetchRentalStatus = async () => {
  isLoadingRentStatus.value = true
  try {
    const memId = memberAuth.member?.memId
    if (!memId) {
      activeRent.value = null
      return
    }

    // æŸ¥è©¢æœƒå“¡çš„ç§Ÿå€Ÿç´€éŒ„ï¼Œç›®çš„æ˜¯ç‚ºäº†æ‰¾åˆ°é€²è¡Œä¸­è¨‚å–®çš„ ID
    const rentListRes = await axios.get(`http://localhost:8080/rec-rent?memId=${memId}`)
    const basicRentInfo = rentListRes.data.find((rent) => rent.recStatus === 'ç§Ÿå€Ÿä¸­')

    // å¦‚æœæ‰¾åˆ°é€²è¡Œä¸­çš„è¨‚å–®
    if (basicRentInfo && basicRentInfo.recId) {
      try {
        // ä½¿ç”¨è¨‚å–® ID å»æŸ¥è©¢å®Œæ•´çš„ã€åŒ…å«ç«™é»åç¨±çš„è©³ç´°è³‡è¨Š
        const detailsRes = await axios.get(
          `http://localhost:8080/api/rent-details/${basicRentInfo.recId}`,
        )
        const currentRentDetails = detailsRes.data

        if (currentRentDetails) {
          activeRent.value = currentRentDetails
          // ç›´æ¥å¾å›å‚³çš„è©³ç´°è³‡æ–™ä¸­å–å¾—ç«™é»åç¨±
          rentSpotName.value = currentRentDetails.spotNameRent || 'æœªçŸ¥ç«™é»'
        } else {
          activeRent.value = null // å¦‚æœè©³ç´°è³‡æ–™æŸ¥ç„¡ï¼Œä¹Ÿç•¶ä½œæ²’æœ‰
        }
      } catch (detailsError) {
        console.error(`æŸ¥è©¢è¨‚å–®è©³ç´°è³‡è¨Š ${basicRentInfo.recId} å¤±æ•—:`, detailsError)
        // Fallback: å³ä½¿è©³ç´°è³‡æ–™æŸ¥è©¢å¤±æ•—ï¼Œä»ç„¶é¡¯ç¤ºåŸºæœ¬è³‡è¨Š
        activeRent.value = basicRentInfo
        rentSpotName.value = 'ç«™é»è³‡æ–™è®€å–å¤±æ•—'
      }
    } else {
      // å¦‚æœé€£åŸºæœ¬è¨‚å–®éƒ½æ‰¾ä¸åˆ°ï¼Œå‰‡ç¢ºèªç„¡ç§Ÿå€Ÿä¸­è¨‚å–®
      activeRent.value = null
    }
  } catch (error) {
    console.error('æŸ¥è©¢ç§Ÿå€Ÿç‹€æ…‹å¤±æ•—:', error)
    activeRent.value = null
  } finally {
    isLoadingRentStatus.value = false
  }
}

onMounted(fetchProfile)

const formatDate = (dt) => {
  if (!dt) return ''
  return dt.substring(0, 10).replace(/-/g, '-')
}

// [æ–°å¢] æ ¼å¼åŒ–æ—¥æœŸæ™‚é–“çš„å‡½å¼
const formatDateTime = (dt) => {
  if (!dt) return ''
  const date = new Date(dt)
  return date
    .toLocaleString('zh-TW', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false,
    })
    .replace(/\//g, '-')
}

const startEdit = () => {
  originForm.value = { ...form.value }
  isEdit.value = true
}

const cancelEdit = () => {
  isEdit.value = false
  fetchProfile()
}

const saveEdit = async () => {
  // å¯†ç¢¼æ ¼å¼åˆæ­¥æª¢æŸ¥ (å‰ç«¯æ“‹è·¯)
  const passwordRegex = /^(?=.*[A-Za-z])[A-Za-z\d!@#$%^&*()_+=\[\]{}:;"'<>,.?/\-]{6,}$/
  if (form.value.memPassword && !passwordRegex.test(form.value.memPassword)) {
    Swal.fire('æ ¼å¼éŒ¯èª¤', 'å¯†ç¢¼å¿…é ˆè‡³å°‘ 6 ç¢¼ä¸”åŒ…å« 1 å€‹è‹±æ–‡å­—æ¯', 'error')
    return
  }

  const phoneRegex = /^09\d{8}$/
  if (!phoneRegex.test(form.value.memPhone.trim())) {
    Swal.fire('æ ¼å¼éŒ¯èª¤', 'æ‰‹æ©Ÿè™Ÿç¢¼è«‹è¼¸å…¥ 09 é–‹é ­çš„ 10 ç¢¼æ•¸å­—', 'error')
    return
  }

  // Email æ ¼å¼ï¼šæ¨™æº–é›»å­éƒµä»¶ï¼Œçµå°¾éœ€ç‚º .com
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]*com$/
  if (!emailRegex.test(form.value.memEmail.trim())) {
    Swal.fire('æ ¼å¼éŒ¯èª¤', 'Email æ ¼å¼ä¸æ­£ç¢ºï¼ˆéœ€åŒ…å« @ ä¸”ä»¥ .com çµå°¾ï¼‰', 'error')
    return
  }

  // ç™¼ç¥¨è¼‰å…·ï¼š/ é–‹é ­ï¼Œå¾Œæ¥ 7 ç¢¼å¤§å¯«è‹±æ–‡æˆ–æ•¸å­—
  const invoiceRegex = /^\/[A-Z0-9]{7}$/
  if (form.value.memInvoice && !invoiceRegex.test(form.value.memInvoice.trim())) {
    Swal.fire('æ ¼å¼éŒ¯èª¤', 'ç™¼ç¥¨è¼‰å…·æ ¼å¼éŒ¯èª¤ï¼ˆæ‡‰ç‚º / é–‹é ­åŠ ä¸Š 7 ç¢¼å¤§å¯«è‹±æ•¸ï¼‰', 'error')
    return
  }

  // äºŒæ¬¡ç¢ºèªå½ˆçª—
  const confirmResult = await Swal.fire({
    title: 'ç¢ºå®šè¦è®Šæ›´è³‡æ–™å—ï¼Ÿ',
    text: 'ä¿®æ”¹å¾Œå°‡æœƒç«‹å³ç”Ÿæ•ˆ',
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#22c55e',
    cancelButtonColor: '#9ca3af',
    confirmButtonText: 'ç¢ºå®šæ›´æ–°',
    cancelButtonText: 'å–æ¶ˆ',
  })

  if (!confirmResult.isConfirmed) return

  try {
    // ä¿®æ­£é€™è£¡çš„è·¯å¾‘èˆ‡æ–¹æ³•
    const res = await axios.post(
      // 1. æ”¹å› post
      'http://localhost:8080/api/members/update', // 2. æŒ‡å‘æ­£ç¢ºçš„å¾Œç«¯è·¯å¾‘
      {
        memId: member.value.memId, // 3. å‹™å¿…å‚³é€ memIdï¼Œå¦å‰‡å¾Œç«¯ findById æœƒæ‰¾ä¸åˆ°äºº
        memName: form.value.memName.trim(),
        memPhone: form.value.memPhone.trim(),
        memEmail: form.value.memEmail.trim(),
        memInvoice: form.value.memInvoice.trim(),
        memPassword: form.value.memPassword,
        memUsername: member.value.memUsername, // å»ºè­°ä¹Ÿå¸¶ä¸Šï¼Œç¢ºä¿è³‡æ–™å®Œæ•´
      },
      { withCredentials: true },
    )

    // 4. æ³¨æ„ï¼šå¾Œç«¯å›å‚³çš„æ˜¯ "æœƒå“¡ä¿®æ”¹æˆåŠŸ"ï¼Œé€™è£¡è¦å°é½Šå­—ä¸²
    if (res.data === 'æœƒå“¡ä¿®æ”¹æˆåŠŸ') {
      Swal.fire({
        title: 'ç·¨è¼¯æˆåŠŸ',
        text: 'æ‚¨çš„è³‡æ–™å·²åŒæ­¥',
        icon: 'success',
        timer: 1500,
        showConfirmButton: false,
      })

      isEdit.value = false
      fetchProfile()
    } else {
      Swal.fire('æ›´æ–°å¤±æ•—', res.data, 'error')
    }
  } catch (e) {
    Swal.fire('ç³»çµ±éŒ¯èª¤', 'ç„¡æ³•é€£æ¥è‡³ä¼ºæœå™¨', 'error')
    form.value = { ...originForm.value }
  }
}
</script>

<template>
  <div class="profile-page">
    <div v-if="errorMsg">{{ errorMsg }}</div>

    <div v-if="member">
      <!-- é ­åƒ + åç¨± -->
      <div class="profile-header">
        <div class="avatar">
          <img
            class="member-photo"
            :src="member.memImage ? `/members/${member.memImage}` : '/members/default.png'"
            @error="(e) => (e.target.src = '/members/default.png')"
            alt="æœƒå“¡é ­åƒ"
          />
          <div v-if="isEdit" class="photo-edit-hint">
            <span>ğŸ“·</span>
          </div>
        </div>
        <div class="name">{{ member.memName }}</div>
      </div>

      <!-- æ“ä½œæŒ‰éˆ• -->
      <div class="actions">
        <template v-if="!isEdit">
          <button @click="toggleHistory" class="btn btn-info">
            {{ showHistory ? 'éš±è—è¨‚å–®æ­·å²' : 'æŸ¥çœ‹è¨‚å–®æ­·å²è³‡è¨Š' }}
          </button>
          <button class="edit-btn" @click="startEdit">ç·¨è¼¯è³‡æ–™</button>
        </template>
        <template v-else>
          <button class="save-btn" @click="saveEdit">å„²å­˜è®Šæ›´</button>
          <button class="cancel-btn" @click="cancelEdit">å–æ¶ˆ</button>
        </template>
      </div>

      <!-- è³‡æ–™å¡ç‰‡ -->
      <div class="profile-card">
        <div class="row">
          <label>å¸³è™Ÿ</label>
          <div class="value">{{ member.memUsername }}</div>
        </div>

        <div class="row">
          <label>å¯†ç¢¼</label>
          <input
            :type="isEdit ? 'password' : 'text'"
            class="value-input"
            v-model="form.memPassword"
            :placeholder="isEdit ? 'è¼¸å…¥æ–°å¯†ç¢¼ä»¥ä¿®æ”¹' : '********'"
            :readonly="!isEdit"
          />
        </div>

        <div class="row">
          <label>å§“å</label>
          <input class="value-input" v-model="form.memName" :readonly="!isEdit" />
        </div>

        <div class="row">
          <label>æ‰‹æ©Ÿ</label>
          <input class="value-input" v-model="form.memPhone" :readonly="!isEdit" />
        </div>

        <div class="row">
          <label>Email</label>
          <input class="value-input" v-model="form.memEmail" :readonly="!isEdit" />
        </div>

        <!-- æœƒå“¡é»æ•¸ï¼ˆå”¯è®€ï¼‰ -->
        <div class="row">
          <label>æœƒå“¡é»æ•¸</label>
          <div class="value">
            {{ member.memPoints }}
          </div>
        </div>

        <!-- ç§Ÿå€Ÿç‹€æ…‹ -->
        <div class="row">
          <label>ç§Ÿå€Ÿç‹€æ…‹</label>
          <div class="value">
            <!-- è®€å–ä¸­ -->
            <div v-if="isLoadingRentStatus" class="placeholder">è®€å–ä¸­...</div>
            <!-- æœ‰ç§Ÿå€Ÿä¸­è¨‚å–® -->
            <div v-else-if="activeRent" class="rent-details">
              <div>
                <strong>ç‹€æ…‹:</strong> <span class="status-active">{{ activeRent.recStatus }}</span>
              </div>
              <div><strong>è¨‚å–®ç·¨è™Ÿ:</strong> {{ activeRent.recId }}</div>
              <div><strong>ç§Ÿå€Ÿç«™é»:</strong> {{ activeRent.rentSpotName }}</div>
              <div><strong>ç§Ÿå€Ÿæ™‚é–“:</strong> {{ formatDateTime(activeRent.recRentDT2) }}</div>
            </div>
            <!-- ç„¡ç§Ÿå€Ÿä¸­è¨‚å–® -->
            <div v-else class="placeholder">ç›®å‰æ²’æœ‰ç§Ÿå€Ÿä¸­çš„è¨‚å–®</div>
          </div>
        </div>

        <div class="row">
          <label>ç™¼ç¥¨è¼‰å…·</label>
          <input class="value-input" v-model="form.memInvoice" :readonly="!isEdit" />
        </div>

        <div class="row">
          <label>è¨»å†Šæ—¥æœŸ</label>
          <div class="value">{{ formatDate(member.createdAt) }}</div>
        </div>
      </div>

      <!-- [æ–°å¢] è¨‚å–®æ­·å²ç´€éŒ„ -->
      <div v-if="showHistory" class="history-container mt-4">
        <RecRentUserRecord />
      </div>
    </div>
  </div>
</template>

<style scoped>
/* æ•´é«” */
.profile-page {
  max-width: 920px;
  width: 100%;
  margin: 0 auto;
  padding: 40px 20px 0; /*  å°è¢å¹•ä¸è²¼é‚Šï¼ˆå·¦å³ 20ï¼‰ */
  box-sizing: border-box;

  /*  å¯ç•™å¯ä¸ç•™ï¼šç•™è‘—ä¹Ÿä¸æœƒå£ï¼Œæœªä¾†æ›´å¥½åšç‰ˆé¢æ§åˆ¶ */
  display: flex;
  flex-direction: column;
}

/* é ­åƒ */
.profile-header {
  text-align: center;
  margin-bottom: 20px;
}

.avatar {
  width: 120px; /* ç¨å¾®åŠ å¤§ä¸€é»æ¯”è¼ƒå¥½çœ‹ */
  height: 120px;
  border-radius: 50%;
  background: #f0f2f5;
  margin: 0 auto 15px;
  position: relative; /* ç‚ºäº†å®šä½ç·¨è¼¯åœ–ç¤º */
  overflow: hidden; /* ç¢ºä¿åœ–ç‰‡è¶…å‡ºåœ“åœˆæœƒè¢«è£åˆ‡ */
  border: 4px solid #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.member-photo {
  width: 100%;
  height: 100%;
  object-fit: cover; /* é—œéµï¼šä¿æŒæ¯”ä¾‹å¡«å…… */
  display: block;
}

/* [æ–°å¢] ç·¨è¼¯æ¨¡å¼çš„åŠé€æ˜é®ç½© */
.photo-edit-hint {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.4);
  color: white;
  padding: 4px 0;
  font-size: 14px;
  cursor: pointer;
}

.name {
  font-size: 20px;
  font-weight: bold;
}

/* æŒ‰éˆ• */
.actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-bottom: 12px;
}

.edit-btn {
  background: #c9a46a;
  color: #fff;
}

.save-btn {
  background: #22c55e;
  color: #fff;
}

.cancel-btn {
  background: #9ca3af;
  color: #fff;
}

.actions button {
  padding: 6px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* å¡ç‰‡ */
.profile-card {
  background: #fff;
  border-radius: 12px;
  width: auto;
  margin: 0 20px 0 20px;
  padding: 20px 20px 5px 20px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.08);
  margin-bottom: 30px;
}

.row {
  display: flex;
  padding: 4px 0;
  font-size: larger;
  border-bottom: 1px solid #eee;
}

.row:last-child {
  border-bottom: none;
  font-size: larger;
}

label {
  width: 120px;
  color: #666;
}

/* input / é¡¯ç¤ºå…±ç”¨ */
.value,
.value-input {
  flex: 1;
  font-size: large;
}

.value-input {
  border: none;
  background: transparent;
}

.value-input:read-only {
  pointer-events: none;
}

.value-input:not(:read-only) {
  border: 1px solid #ccc;
  padding: 6px 8px;
  border-radius: 6px;
  background: #fff;
}

/* ç·¨è¼¯è³‡æ–™ */
.edit-btn:hover {
  background: #b8935a;
}

/* å„²å­˜è®Šæ›´ */
.save-btn:hover {
  background: #16a34a;
}

/* å–æ¶ˆ */
.cancel-btn:hover {
  background: #6b7280;
}

/* é€šç”¨ hover æ‰‹æ„Ÿ */
.actions button:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

.placeholder {
  color: #9ca3af;
  font-style: italic;
}

.rent-details > div {
  padding: 2px 0;
}

.status-active {
  background-color: #28a745; /* ç¶ è‰²èƒŒæ™¯ */
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
}
</style>
</file>

<file path="frontend/src/views/member/MemberListView.vue">
<script setup>
import { ref, onMounted, computed } from 'vue'
import { useRouter } from 'vue-router'
import axios from 'axios'
import Swal from 'sweetalert2'
import { useAdminAuthStore } from '@/stores/adminAuth'

import { Bar, Line } from 'vue-chartjs'
import { 
  Chart as ChartJS, Title, Tooltip, Legend, BarElement, 
  CategoryScale, LinearScale, PointElement, LineElement 
} from 'chart.js'

ChartJS.register(Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale, PointElement, LineElement)

const router = useRouter()
const members = ref([])
const keyword = ref('')
const loading = ref(false)
const authStore = useAdminAuthStore()

// --- åˆ†é æ§åˆ¶ ---
const currentPage = ref(1)
const pageSize = 6 

// --- å½ˆçª—æ§åˆ¶ ---
const showModal = ref(false)
const selectedMember = ref(null)

// --- ç‹€æ…‹åˆ‡æ›èˆ‡åœæ¬Šå½ˆçª— ---
const filterStatus = ref(1) // 1: å•Ÿç”¨, 0: åœç”¨
const showBanModal = ref(false)
const banReason = ref('')
const memberToBan = ref(null)

// å–å¾—æœƒå“¡
const fetchMembers = async () => {
  loading.value = true
  try {
    const res = await axios.get('http://localhost:8080/api/members')
    members.value = res.data
    currentPage.value = 1 
  } catch (error) {
    Swal.fire({
      icon: 'error',
      title: 'è¼‰å…¥å¤±æ•—',
      text: 'å–å¾—æœƒå“¡è³‡æ–™å¤±æ•—',
      confirmButtonColor: '#f56c6c'
    })
  } finally {
    loading.value = false
  }
}

// éæ¿¾èˆ‡åˆ†é 
const filteredMembers = computed(() => {
  return members.value.filter(m => m.memStatus === filterStatus.value)
})

const paginatedMembers = computed(() => {
  const start = (currentPage.value - 1) * pageSize
  return filteredMembers.value.slice(start, start + pageSize)
})

const totalPages = computed(() => {
  return Math.ceil(filteredMembers.value.length / pageSize) || 1
})

const openMemberDetail = (member) => {
  selectedMember.value = member
  showModal.value = true
}

// æ¨¡ç³Šæœå°‹ (å®Œå…¨ä¿ç•™åŸé‚è¼¯èˆ‡æ¨£å¼)
const searchMembers = async () => {
  // å¦‚æœé—œéµå­—ç‚ºç©ºï¼Œé¡¯ç¤ºå…¨éƒ¨è³‡æ–™
  if (!keyword.value.trim()) {
    fetchMembers()
    return
  }

  loading.value = true
  try {
    const res = await axios.get('http://localhost:8080/api/members/search', {
      params: { keyword: keyword.value.trim() }
    })

    members.value = res.data
    currentPage.value = 1 // æœå°‹å¾Œå›åˆ°ç¬¬ä¸€é 

    // --- å®Œæ•´é‚„åŸï¼šé¡¯ç¤ºæœå°‹çµæœæç¤º ---
    if (res.data.length === 0) {
      Swal.fire({
        icon: 'warning',
        title: 'æŸ¥ç„¡çµæœ',
        text: `æ‰¾ä¸åˆ°åŒ…å«ã€Œ${keyword.value.trim()}ã€çš„æœƒå“¡è³‡æ–™`,
        confirmButtonText: 'ç¢ºå®š',
        confirmButtonColor: '#e6a23c'
      })
    } else {
      Swal.fire({
        icon: 'success',
        title: 'æœå°‹æˆåŠŸ',
        text: `æ‰¾åˆ° ${res.data.length} ç­†ç¬¦åˆçš„æœƒå“¡è³‡æ–™`,
        timer: 1500,
        showConfirmButton: false
      })
    }
  } catch (error) {
    // --- å®Œæ•´é‚„åŸï¼šæœå°‹å¤±æ•—æç¤º ---
    Swal.fire({
      icon: 'error',
      title: 'æœå°‹å¤±æ•—',
      text: error.response?.data?.message || 'æœå°‹éç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦',
      confirmButtonText: 'ç¢ºå®š',
      confirmButtonColor: '#f56c6c'
    })
  } finally {
    loading.value = false
  }
}

// åœæ¬Šé‚è¼¯
const openBanModal = (member) => {
  memberToBan.value = member
  banReason.value = ''
  showBanModal.value = true
}

const confirmBanMember = async () => {
  if (!banReason.value.trim()) {
    Swal.fire({ icon: 'warning', title: 'è«‹è¼¸å…¥åŸå› ', confirmButtonColor: '#e6a23c' })
    return
  }
  try {
    await axios.post('http://localhost:8080/api/members/ban', {
      memId: memberToBan.value.memId,
      reason: banReason.value
    })
    showBanModal.value = false
    Swal.fire({ icon: 'success', title: 'è©²æœƒå“¡å·²ç§»è‡³åœæ¬Šå€', timer: 1500, showConfirmButton: false })
    fetchMembers()
  } catch (error) {
    Swal.fire({ icon: 'error', title: 'æ“ä½œå¤±æ•—' })
  }
}

// æ¢å¾©å•Ÿç”¨ (åŠ å› SweetAlert ç¢ºèª)
const activateMember = async (member) => {
  const result = await Swal.fire({
    title: 'ç¢ºå®šè¦é‡æ–°å•Ÿç”¨å—ï¼Ÿ',
    text: `å³å°‡æ¢å¾©æœƒå“¡ï¼š${member.memName} çš„æ¬Šé™`,
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#67c23a',
    cancelButtonColor: '#909399',
    confirmButtonText: 'ç¢ºå®šå•Ÿç”¨',
    cancelButtonText: 'å–æ¶ˆ'
  })

  if (result.isConfirmed) {
    try {
      await axios.post('http://localhost:8080/api/members/activate', { memId: member.memId })
      Swal.fire({ icon: 'success', title: 'å·²é‡æ–°å•Ÿç”¨', timer: 1500, showConfirmButton: false })
      fetchMembers()
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'æ¢å¾©å¤±æ•—' })
    }
  }
}

const formatDateOnly = (dt) => {
  if (!dt) return ''
  return dt.substring(0, 10).replace(/-/g, '/')
}

const clearSearch = () => {
  keyword.value = ''
  fetchMembers()
}

const checkPermission = (actionCallback) => {
  const role = authStore.admin?.role; 
  if (authStore.isLogin && Number(role) === 9) {
    actionCallback();
  } else {
    Swal.fire({
      icon: 'lock',
      title: 'æ¬Šé™ä¸è¶³',
      text: 'æ‚¨ç›®å‰çš„èº«åˆ†æ˜¯ä¸€èˆ¬ç®¡ç†å“¡ï¼Œç„¡æ³•åŸ·è¡Œæ­¤æ“ä½œã€‚',
      confirmButtonColor: '#f56c6c'
    });
  }
};

// --- çµ±è¨ˆé‚è¼¯ï¼šé»æ•¸ç´šè· ---
const pointStats = computed(() => {
  const dist = { '0-100': 0, '101-500': 0, '501-1000': 0, '1000+': 0 }
  members.value.forEach(m => {
    if (m.memPoints <= 100) dist['0-100']++
    else if (m.memPoints <= 500) dist['101-500']++
    else if (m.memPoints <= 1000) dist['501-1000']++
    else dist['1000+']++
  })
  return dist
})

// --- çµ±è¨ˆé‚è¼¯ï¼šè¨»å†Šè¶¨å‹¢ ---
const registrationStats = computed(() => {
  const counts = {}
  members.value.forEach(m => {
    if (m.createdAt) {
      const date = m.createdAt.substring(0, 10)
      counts[date] = (counts[date] || 0) + 1
    }
  })
  const sortedDates = Object.keys(counts).sort()
  return {
    labels: sortedDates,
    data: sortedDates.map(d => counts[d])
  }
})

// --- åœ–è¡¨æ•¸æ“šé…ç½® ---
const lineChartData = computed(() => ({
  labels: registrationStats.value.labels,
  datasets: [{
    label: 'æ¯æ—¥æ–°è¨»å†Šäººæ•¸',
    data: registrationStats.value.data,
    borderColor: '#409eff',
    backgroundColor: 'rgba(64, 158, 255, 0.1)',
    tension: 0.4,
    fill: true
  }]
}))

const barChartData = computed(() => ({
  labels: Object.keys(pointStats.value),
  datasets: [{
    label: 'æœƒå“¡äººæ•¸',
    data: Object.values(pointStats.value),
    backgroundColor: ['#95d475', '#409eff', '#f89898', '#eebe77']
  }]
}))

// --- CSV åŒ¯å‡ºé‚è¼¯ ---
const exportToCSV = () => {
  if (members.value.length === 0) {
    Swal.fire('æç¤º', 'ç›®å‰ç„¡è³‡æ–™å¯å°å‡º', 'info');
    return;
  }

  // å®šç¾©æ¨™é¡Œåˆ—
  const headers = ['æœƒå“¡ID', 'å¸³è™Ÿ', 'å§“å', 'Email', 'æ‰‹æ©Ÿ', 'é»æ•¸', 'è¨»å†Šæ—¥æœŸ'];

  // è™•ç†è³‡æ–™å…§å®¹
  const rows = members.value.map(m => [
    `\t${m.memId}`,
    `\t${m.memUsername}`,
    `\t${m.memName}`,
    m.memEmail,
    `\t${m.memPhone}`, // åŠ  \t è§£æ±º 9.1E+08 (ç§‘å­¸è¨˜è™Ÿ)
    m.memPoints,
    `\t${m.createdAt?.substring(0, 10)}` // åŠ  \t è§£æ±º #### ä¸¦æ ¼å¼åŒ–æ—¥æœŸ
  ]);

  // è½‰æˆ CSV å­—ä¸²ï¼Œä¸¦ç”¨é€—è™Ÿåˆ†éš”
  const csvContent = [
    headers.join(','),
    ...rows.map(row => row.join(','))
  ].join('\n');

  // åŠ ä¸Š BOM (\uFEFF) è§£æ±º Excel é–‹å•Ÿä¸­æ–‡äº‚ç¢¼å•é¡Œ
  const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `æœƒå“¡åå–®_${new Date().toLocaleDateString()}.csv`;
  link.click();
  URL.revokeObjectURL(url);
};

onMounted(fetchMembers)
</script>

<template>
  <div class="member-page">
    <h2 class="title"><i class="fas fa-users"></i> æœƒå“¡åˆ—è¡¨</h2>

    <div class="dashboard-grid">
      <div class="chart-card">
        <div class="chart-header">
          <span class="chart-title"><i class="fas fa-chart-line"></i> è¨»å†Šæˆé•·è¶¨å‹¢</span>
          <button class="btn-csv" @click="exportToCSV">
            <i class="fas fa-file-download"></i> åŒ¯å‡ºå ±è¡¨ (CSV)
          </button>
        </div>
        <div class="chart-body">
          <Line :data="lineChartData" :options="chartOptions" />
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <span class="chart-title"><i class="fas fa-chart-pie"></i> æœƒå“¡é»æ•¸ç´šè·</span>
        </div>
        <div class="chart-body">
          <Bar :data="barChartData" :options="chartOptions" />
        </div>
      </div>
    </div>

    <div class="toolbar">
      <div class="search-bar">
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input
            v-model="keyword"
            type="text"
            placeholder="æœå°‹ï¼šå¸³è™Ÿ / å§“å / Email / æ‰‹æ©Ÿ"
            @keyup.enter="searchMembers"
            :disabled="loading"
          />
          <button v-if="keyword" class="clear-btn" @click="clearSearch">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-search" @click="searchMembers" :disabled="loading">
          <i class="fas fa-search"></i> æœå°‹
        </button>
        <button class="btn-refresh" @click="fetchMembers" :disabled="loading">
          <i class="fas fa-sync-alt"></i> é¡¯ç¤ºå…¨éƒ¨
        </button>
      </div>
      <div class="create-bar">
        <div class="status-toggle-group">
          <button 
            class="toggle-btn" 
            :class="{ active: filterStatus === 1 }" 
            @click="filterStatus = 1"
          >å•Ÿç”¨æœƒå“¡</button>
          <button 
            class="toggle-btn" 
            :class="{ active: filterStatus === 0 }" 
            @click="filterStatus = 0"
          >åœç”¨æœƒå“¡</button>
        </div>
        <button class="btn-create" @click="checkPermission(() => router.push('/admin/members/create'))">
          <i class="fas fa-user-plus"></i> æ–°å¢æœƒå“¡
        </button>
      </div>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th class="col-id">ID</th>
            <th class="col-info">æœƒå“¡è³‡è¨Š</th>
            <th class="col-points">é»æ•¸</th>
            <th class="col-date">{{ filterStatus === 1 ? 'è¨»å†Šæ—¥æœŸ' : 'åœç”¨æ—¥æœŸ' }}</th>
            <th class="col-status">ç‹€æ…‹</th>
            <th class="col-action">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            v-for="m in paginatedMembers" 
            :key="m.memId" 
            :class="{ 'row-active': selectedMember?.memId === m.memId && showModal }"
          >
            <td class="col-id id-link-cell" @click="openMemberDetail(m)">{{ m.memId }}</td>
            <td class="col-info">
              <div class="info-cell">
                <div class="list-avatar-wrap">
                  <img :src="m.memImage ? '/members/' + m.memImage : '/members/default.png'" />
                </div>
                <div class="user-text">
                  <span class="user-name">{{ m.memName }}</span>
                  <span class="user-phone">{{ m.memPhone }}</span>
                </div>
              </div>
            </td>
            <td class="col-points"><span class="points-val">{{ m.memPoints }}</span></td>
            <td class="col-date">
              {{ filterStatus === 1 ? formatDateOnly(m.createdAt) : formatDateOnly(m.updatedAt) }}
            </td>
            <td class="col-status">
              <span class="status-badge" :class="m.memStatus === 1 ? 'status-active' : 'status-inactive'">
                {{ m.memStatus === 1 ? 'å•Ÿç”¨' : 'åœç”¨' }}
              </span>
            </td>
            <td class="col-action">
              <div class="action-btns">
                <button 
                  v-if="filterStatus === 1" 
                  class="btn-box-edit" 
                  @click="checkPermission(() => router.push(`/admin/members/edit/${m.memId}`))"
                >ä¿®æ”¹</button>
                
                <button 
                  v-if="m.memStatus === 1"
                  class="btn-box-del" 
                  @click="checkPermission(() => openBanModal(m))"
                >åœæ¬Š</button>
                
                <button 
                  v-else
                  class="btn-box-active" 
                  @click="checkPermission(() => activateMember(m))"
                >å•Ÿç”¨</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination-bar" v-if="filteredMembers.length > pageSize">
      <button class="btn-page" :disabled="currentPage === 1" @click="currentPage--">ä¸Šä¸€é </button>
      <span class="page-info">ç¬¬ {{ currentPage }} / {{ totalPages }} é </span>
      <button class="btn-page" :disabled="currentPage === totalPages" @click="currentPage++">ä¸‹ä¸€é </button>
    </div>

    <div v-if="showBanModal" class="modal-overlay" @click.self="showBanModal = false">
      <div class="ban-card">
        <div class="ban-header">
          <span>åœæ¬Šæœƒå“¡</span>
          <button class="close-x" @click="showBanModal = false">&times;</button>
        </div>
        <div class="ban-body">
          <label>åœæ¬ŠåŸå›  <span class="required">*</span></label>
          <textarea v-model="banReason" placeholder="è«‹è¼¸å…¥åœæ¬ŠåŸå› ..."></textarea>
          <div class="ban-warning">
            <i class="fas fa-exclamation-triangle"></i>
            æ³¨æ„ï¼šåœæ¬Šå¾Œè©²æœƒå“¡å°‡ç„¡æ³•ä½¿ç”¨æœå‹™ï¼Œç›´åˆ°é‡æ–°å•Ÿç”¨ç‚ºæ­¢ã€‚
          </div>
        </div>
        <div class="ban-footer">
          <button class="btn-close-modal" @click="showBanModal = false">å–æ¶ˆ</button>
          <button class="btn-confirm-ban" @click="confirmBanMember">ç¢ºèªåœæ¬Š</button>
        </div>
      </div>
    </div>

    <div v-if="showModal && selectedMember" class="modal-overlay" @click.self="showModal = false">
      <div class="compact-card">
        <div class="card-header">
          <h3><i class="fas fa-id-card"></i> æœƒå“¡è©³ç´°è³‡è¨Š</h3>
          <button class="close-x" @click="showModal = false">&times;</button>
        </div>
        <div class="card-body">
          <div class="compact-sidebar">
            <div class="mini-avatar">
              <img :src="selectedMember.memImage ? `/members/${selectedMember.memImage}` : '/members/default.png'" />
            </div>
            <h4 class="sidebar-name">{{ selectedMember.memName }}</h4>
            <span class="sidebar-user">@{{ selectedMember.memUsername }}</span>
          </div>
          <div class="compact-main">
            <div class="data-section">
              <h5 class="section-title">å€‹äººè³‡è¨Š</h5>
              <div class="mini-grid">
                <div class="grid-item">
                  <label>æœƒå“¡ ID</label>
                  <span>{{ selectedMember.memId }}</span>
                </div>
                <div class="grid-item">
                  <label>è¯çµ¡é›»è©±</label>
                  <span>{{ selectedMember.memPhone || 'æœªæä¾›' }}</span>
                </div>
                <div class="grid-item">
                  <label>é›»å­ä¿¡ç®±</label>
                  <span>{{ selectedMember.memEmail }}</span>
                </div>
                <div class="grid-item">
                  <label>ç™¼ç¥¨è¼‰å…·</label>
                  <span class="text-blue">{{ selectedMember.memInvoice || 'æœªæä¾›' }}</span>
                </div>
                <div class="grid-item">
                  <label>ç›®å‰é»æ•¸</label>
                  <span class="text-green">{{ selectedMember.memPoints }}</span>
                </div>
              </div>
            </div>
            <div class="data-section">
              <h5 class="section-title">ç³»çµ±è³‡è¨Š</h5>
              <div class="mini-grid">
                <div class="grid-item">
                  <label>è¨»å†Šæ—¥æœŸ</label>
                  <span>{{ formatDateOnly(selectedMember.createdAt) }}</span>
                </div>
                <div class="grid-item">
                  <label>å¸³è™Ÿç‹€æ…‹</label>
                  <span :class="selectedMember.memStatus === 1 ? 'status-text-active' : 'status-text-inactive'">
                    {{ selectedMember.memStatus === 1 ? 'å•Ÿç”¨' : 'åœç”¨' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <button class="btn-close-modal" @click="showModal = false">é—œé–‰è¦–çª—</button>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.member-page {
  min-height: 100vh;
  background-color: #f0f5fa;
  padding: 20px;
}

.title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #303133;
  margin-bottom: 20px;
}

.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 16px 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
}

.search-bar {
  display: flex;
  gap: 10px;
}

.search-input-wrapper {
  position: relative;
  width: 350px;
}

.search-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: #c0c4cc;
}

.search-input-wrapper input {
  width: 100%;
  padding: 10px 40px;
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  background: #f5f7fa;
  transition: border-color 0.3s;
}

.search-input-wrapper input:focus {
  border-color: #409eff;
  outline: none;
}

.clear-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #909399;
  cursor: pointer;
}

.btn-search {
  padding: 10px 18px;
  background: #409eff;
  color: white;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn-search:hover {
  background: #66b1ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(64, 158, 255, 0.3);
}

.btn-refresh {
  padding: 10px 18px;
  background: #67c23a;
  color: white;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn-refresh:hover {
  background: #85ce61;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(103, 194, 58, 0.3);
}

.create-bar {
  display: flex;
  align-items: center;
  gap: 15px;
}

.status-toggle-group {
  display: flex;
  border: 1px solid #409eff;
  border-radius: 6px;
  overflow: hidden;
}

.toggle-btn {
  padding: 8px 16px;
  border: none;
  background: white;
  color: #409eff;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s;
}

.toggle-btn.active {
  background: #409eff;
  color: white;
}

.btn-create {
  padding: 10px 20px;
  background: #67c23a;
  color: white;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn-create:hover {
  background: #85ce61;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(103, 194, 58, 0.3);
}

.table-container {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
}

table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

th, td {
  padding: 16px 12px;
  text-align: center;
  border-bottom: 1px solid #ebeef5;
}

th {
  background: #f5f7fa;
  color: #606266;
  font-weight: 600;
}

.col-id {
  width: 70px;
}

.col-info {
  width: 280px;
  text-align: left !important;
  padding-left: 20px;
}

.col-points {
  width: 100px;
}

.col-date {
  width: 150px;
}

.col-status {
  width: 100px;
}

.col-action {
  width: 160px;
}

.info-cell {
  display: flex;
  align-items: center;
  gap: 12px;
}

.list-avatar-wrap img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 1px solid #eee;
}

.user-text {
  display: flex;
  flex-direction: column;
}

.user-name {
  font-weight: 600;
  color: #303133;
}

.user-phone {
  font-size: 12px;
  color: #909399;
}

.id-link-cell {
  color: #409eff;
  font-weight: 600;
  cursor: pointer;
  text-decoration: underline;
}

.points-val {
  color: #f59e0b;
  font-weight: bold;
}

.status-badge {
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
}

.status-active {
  background: #f0f9ff;
  color: #409eff;
  border: 1px solid #b3d8ff;
}

.status-inactive {
  background: #fef0f0;
  color: #f56c6c;
  border: 1px solid #fbc4c4;
}

.action-btns {
  display: flex;
  justify-content: center;
  gap: 8px;
}

.btn-box-edit {
  background-color: #409eff;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-box-edit:hover {
  background-color: #66b1ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(64, 158, 255, 0.3);
}

.btn-box-del {
  background-color: #f56c6c;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-box-del:hover {
  background-color: #f78989;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(245, 108, 108, 0.3);
}

.btn-box-active {
  background-color: #67c23a;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-box-active:hover {
  background-color: #85ce61;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(103, 194, 58, 0.3);
}

.pagination-bar {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 20px;
  margin-top: 25px;
}

.btn-page {
  padding: 8px 16px;
  background: white;
  border: 1px solid #dcdfe6;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn-page:not(:disabled):hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(64, 158, 255, 0.2);
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.ban-card {
  background: white;
  width: 450px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.ban-header {
  background: #ffc107;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  align-items: center;
}

.ban-body {
  padding: 20px;
}

.ban-body textarea {
  width: 100%;
  height: 120px;
  margin-top: 10px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  resize: none;
}

.ban-warning {
  margin-top: 15px;
  background: #fff9db;
  padding: 10px;
  border-radius: 4px;
  font-size: 13px;
  color: #856404;
}

.ban-footer {
  padding: 15px 20px;
  text-align: right;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.btn-confirm-ban {
  background: #f44336;
  color: white;
  border: none;
  padding: 8px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-confirm-ban:hover {
  background: #d32f2f;
  transform: translateY(-1px);
}

.compact-card {
  background: white;
  width: 600px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.card-header {
  padding: 15px 20px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card-body {
  display: flex;
}

.compact-sidebar {
  width: 180px;
  background: #f9f9f9;
  padding: 25px 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  border-right: 1px solid #eee;
}

.mini-avatar img {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #409eff;
}

.sidebar-name {
  margin-top: 10px;
  font-size: 1.1rem;
}

.sidebar-user {
  font-size: 12px;
  color: #999;
}

.compact-main {
  flex: 1;
  padding: 20px;
}

.data-section {
  margin-bottom: 20px;
}

.section-title {
  border-left: 3px solid #409eff;
  padding-left: 8px;
  margin-bottom: 12px;
  font-size: 14px;
  font-weight: 600;
}

.mini-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.grid-item {
  display: flex;
  flex-direction: column;
}

.grid-item label {
  font-size: 11px;
  color: #bbb;
  margin-bottom: 4px;
}

.text-green {
  color: #67c23a;
  font-weight: bold;
}

.text-blue {
  color: #409eff;
  font-weight: bold;
}

.status-text-active {
  color: #409eff;
}

.status-text-inactive {
  color: #f56c6c;
}

.card-footer {
  padding: 15px 20px;
  text-align: right;
  border-top: 1px solid #eee;
}

.btn-close-modal {
  padding: 8px 20px;
  background: #909399;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-close-modal:hover {
  background: #a6a9ad;
  transform: translateY(-1px);
}

.close-x {
  position: absolute;
  top: 15px;         /* è·é›¢é ‚éƒ¨é«˜åº¦ */
  right: 20px;
  border: none;
  background: none;
  font-size: 24px;
  cursor: pointer;
  color: #333;
  transition: all 0.2s;
}

.close-x:hover {
  color: #f56c6c;
  transform: rotate(90deg);
}

.required {
  color: red;
}

.row-active {
  background-color: #ecf5ff !important; /* æ·¡æ·¡çš„è—è‰²é¸ä¸­æ„Ÿ */
  transition: background-color 0.3s;
}

.row-active .id-link-cell {
  color: #66b1ff;
  text-shadow: 0 0 2px rgba(64, 158, 255, 0.2);
}

.dashboard-grid {
  display: grid;
  grid-template-columns: 1.6fr 1fr; /* å·¦å¯¬å³çª„ */
  gap: 20px;
  margin-bottom: 20px;
}

.chart-card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.chart-title {
  font-weight: 600;
  color: #606266;
  font-size: 14px;
}

.chart-body {
  height: 230px; /* å›ºå®šé«˜åº¦ï¼Œé¿å…è¡¨æ ¼è¢«æ¨å¤ªé  */
}

.btn-csv {
  padding: 6px 12px;
  background-color: #f0f9ff;
  color: #409eff;
  border: 1px solid #d9ecff;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-csv:hover {
  background-color: #409eff;
  color: white;
}

/* è®“åœ–è¡¨è®Šå‚ç›´æ’åˆ— */
@media (max-width: 1024px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</file>

<file path="frontend/src/router/index.js">
import { createRouter, createWebHistory } from 'vue-router'
import Swal from 'sweetalert2'

/**
 * ==========================================
 * 1. éœæ…‹å°å…¥å…ƒä»¶ (Static Imports)
 * ==========================================
 */
import LoginView from '@/views/member/LoginView.vue' // ç™»å…¥é 
import AdminLayout from '@/layouts/AdminLayout.vue' // å¾Œè‡ºä¸»æ¡†æ¶ (åŒ…å«å´é‚Šæ¬„èˆ‡ Header)
import AdminHomeView from '@/views/member/AdminHomeView.vue' // å¾Œè‡ºé¦–é (å„€è¡¨æ¿)
import MemberListView from '@/views/member/MemberListView.vue' // æœƒå“¡åˆ—è¡¨
import MemberEditView from '@/views/member/MemberEditView.vue' // æœƒå“¡ç·¨è¼¯
import MemberCreateView from '@/views/member/MemberCreateView.vue' // æœƒå“¡æ–°å¢
import PaymentView from '@/views/ecpay/PaymentView.vue' // ç¶ ç•Œä»˜æ¬¾é 
import AdminListView from '@/views/member/AdminListView.vue' // ç®¡ç†å“¡åˆ—è¡¨
import AdminCreateView from '@/views/member/AdminCreateView.vue' // ç®¡ç†å“¡æ–°å¢
import AdminEditView from '@/views/member/AdminEditView.vue' // ç®¡ç†å“¡ç·¨è¼¯
import MemberLayout from '@/layouts/MemberLayout.vue' // æœƒå“¡ä¸»æ¡†æ¶
import MemberProfileView from '@/views/member/MemberProfileView.vue' // æœƒå“¡å€‹äººè³‡æ–™é 
import AuthLayout from '@/layouts/AuthLayout.vue' // èªè­‰ç›¸é—œé é¢æ¡†æ¶
import MainLayout from '@/layouts/MainLayout.vue' // å‰å°ä¸»æ¡†æ¶
import HomeView from '@/views/HomeView.vue' // å‰å°é¦–é 

/**
 * ==========================================
 * 2. æ‡¶åŠ è¼‰å°å…¥ (Dynamic Imports)
 * ==========================================
 */
const MerchantList = () => import('@/views/merchantAndCoupon/MerchantList.vue') // å•†å®¶åˆ—è¡¨
const DiscountList = () => import('@/views/merchantAndCoupon/DiscountList.vue') // å„ªæƒ åˆ¸åˆ—è¡¨
const RedemptionLogList = () => import('@/views/merchantAndCoupon/RedemptionLogList.vue') // æ–°å¢ï¼šå¾Œå°ç´€éŒ„
const CouponMall = () => import('@/views/merchantAndCoupon/CouponMallView.vue') // æ–°å¢ï¼šå‰å°å•†åŸ
const SnakeGame = () => import('@/views/game/SnakeGame.vue') // è²ªé£Ÿè›‡éŠæˆ²

// å®šç¾©è·¯ç”±è¡¨
const routes = [
  // --- ç™»å…¥é é¢ ---
  {
    path: '/login',
    name: 'login',
    component: LoginView,
  },

  // ==========================================
  // [æ–°å¢] å‰å°ä½¿ç”¨è€…é é¢ (ä¸å¥—ç”¨å¾Œå°å´é‚Šæ¬„)
  // ==========================================
  {
    path: '/',
    name: 'entrance',
    component: MainLayout,
    children: [
      {
        path: '',
        name: 'home',
        component: HomeView,
      },

      // æœƒå“¡é é¢
      {
        path: 'profile',
        name: 'member-profile',
        component: MemberProfileView,
      },

      // ç§Ÿå€Ÿé é¢
      {
        path: 'rent/:action?',
        name: 'rec-rent-user',
        component: () => import('@/views/rec/RecRentUserPage.vue'),
      },
      {
        path: 'SearchSpot',
        name: 'SearchSpot',
        component: () => import('@/views/rec/RecRentUserSearchPage.vue'),
      },
      {
        path: 'VisitSiteReommand',
        name: 'VisitSiteReommand',
        component: () => import('@/views/rec/VisitSiteReommandPage.vue'),
      },

      // å°‡ 'rec-rent-record' è·¯ç”±é‡å®šå‘è‡³å¸¶æœ‰ action åƒæ•¸çš„æ¨™æº–ç§Ÿå€Ÿè·¯ç”±
      {
        path: 'recordRoute',
        name: 'rec-rent-record',
        redirect: { name: 'rec-rent-user', params: { action: 'record' } },
      },

      {
        path: 'payment/order',
        name: 'payment-order',
        component: () => import('@/views/ecpay/PaymentViewOrder.vue'),
      },
      {
        path: 'claims',
        name: 'claims',
        component: () => import('@/views/rec/RightsClaimPage.vue'),
      },

      // --- æ–°å¢ï¼šå„ªæƒ åˆ¸å•†åŸ ---
      {
        path: '/mall',
        name: 'coupon-mall',
        component: CouponMall,
      },

      // --- æ–°å¢ï¼šå‰å°è²ªé£Ÿè›‡éŠæˆ² ---
      {
        path: '/snake',
        name: 'snake-game',
        component: SnakeGame,
      },
      {
        path: '/redemption-history',
        name: 'redemption-history',
        component: () => import('@/views/merchantAndCoupon/RedemptionHistory.vue'),
      },
      {
        path: '/sponsor',
        name: 'sponsor',
        component: () => import('@/views/ecpay/SponsorView.vue'),
      },
      {
        path: '/payment-success',
        name: 'payment-success',
        component: () => import('@/views/ecpay/PaymentSuccessView.vue'),
      },

      // è¨‚å–®ç¢ºèªèˆ‡ä»˜æ¬¾é 
      {
        path: '/payment-checkout/:recId',
        name: 'payment-checkout',
        component: () => import('@/views/ecpay/PaymentView.vue'),
      },

      // ==========================================
      // (ç¿Œå¸†2026-1-31)ã€æ–°å¢ã€‘å®¢æœæ”¯æ´æ¨¡çµ„ (Support)
      // ==========================================
      {
        path: '/support',
        name: 'support-center',
        component: () => import('@/views/support/SupportCenterView.vue'),
      },
      {
        path: '/support/report',
        name: 'support-report-entry',
        component: () => import('@/views/support/ReportEntryView.vue'),
      },
      {
        path: '/support/report/damage',
        name: 'support-report-damage',
        component: () => import('@/views/support/ReportDamageView.vue'),
      },
      {
        path: '/support/report/manual',
        name: 'support-report-manual',
        component: () => import('@/views/support/ReportManualView.vue'),
      },
    ],
  },

  // è¨»å†Šæœƒå“¡
  {
    path: '/register',
    component: AuthLayout,
    children: [
      {
        path: '',
        component: () => import('@/views/member/Register.vue'),
      },
    ],
  },

  /**
   * ==========================================
   * 3. ç®¡ç†å¾Œè‡ºåµŒå¥—è·¯ç”± (Nested Routes)
   * ç¶²å€å‰ç¶´çµ±ä¸€ç‚º /admin
   * ==========================================
   */
  {
    path: '/admin',
    component: AdminLayout,
    children: [
      // ç®¡ç†å¾Œè‡ºé¦–é 
      {
        path: '',
        name: 'admin-home',
        component: AdminHomeView,
      },

      // æ“šé»èˆ‡åº§ä½ç®¡ç† (Spot & Seat)
      {
        path: 'spot/list',
        name: 'spot-list',
        component: () => import('@/views/spot/SpotList.vue'),
      },

      // æ“šé»æ–°å¢èˆ‡ç·¨è¼¯å…±ç”¨åŒä¸€å€‹å…ƒä»¶
      {
        path: 'spot/add',
        name: 'spot-add',
        component: () => import('@/views/spot/SpotForm.vue'),
      },

      // æ“šé»ç·¨è¼¯
      {
        path: 'spot/edit/:id',
        name: 'spot-edit',
        component: () => import('@/views/spot/SpotForm.vue'),
      },

      // æ“šé»è©³ç´°è³‡è¨Š
      {
        path: 'spot/view/:id', // ç¶²å€: /admin/spot/view/1
        name: 'spot-view',
        component: () => import('@/views/spot/SpotOne.vue'),
      },
      // æ“šé»çµ±è¨ˆå„€è¡¨æ¿
      {
        path: 'spot/analyze',
        name: 'spot-analyze',
        component: () => import('@/views/spot/SpotAnalyze.vue'),
      },
      {
        path: 'spot/monitor',
        name: 'dispatch-monitor',
        component: () => import('@/views/spot/DispatchMonitor.vue'),
      },
      // ==========================================
      // [æ•´åˆ] åº§ä½ç®¡ç†æ¨¡çµ„ (Seat)
      // ==========================================
      // åº§ä½ç®¡ç†

      {
        path: 'seat/list',
        name: 'seat-list',
        component: () => import('@/views/spot/SeatList.vue'),
      },

      // åº§ä½æ–°å¢èˆ‡ç·¨è¼¯å…±ç”¨åŒä¸€å€‹å…ƒä»¶
      {
        path: 'seat/insert',
        name: 'seat-insert',
        component: () => import('@/views/spot/SeatForm.vue'),
      },

      // åº§ä½ç·¨è¼¯
      {
        path: 'seat/edit/:id',
        name: 'seat-edit',
        component: () => import('@/views/spot/SeatForm.vue'),
      },

      // åº§ä½è©³ç´°è³‡è¨Š
      {
        path: 'seat/view/:id',
        name: 'seat-view',
        component: () => import('@/views/spot/SeatOne.vue'),
      },

      // [æ ¸å¿ƒåŠŸèƒ½] å•†å®¶èˆ‡å„ªæƒ åˆ¸ç®¡ç†
      {
        path: 'merchants',
        name: 'merchants',
        component: MerchantList,
      },

      // å„ªæƒ åˆ¸ç®¡ç†
      {
        path: 'discounts',
        name: 'discounts',
        component: DiscountList,
        alias: 'coupons',
      },
      // --- æ–°å¢ï¼šå…Œæ›ç´€éŒ„å ±è¡¨ ---
      {
        path: 'redemption-logs',
        name: 'admin-redemption-logs',
        component: RedemptionLogList,
      },

      // [æ–°å¢] å¾Œå°è²ªé£Ÿè›‡éŠæˆ²
      {
        path: 'snake-game',
        name: 'admin-snake-game',
        component: SnakeGame,
      },
      {
        path: 'sponsors',
        name: 'admin-sponsors',
        component: () => import('@/views/ecpay/SponsorLog.vue'),
      },

      // [æ ¸å¿ƒåŠŸèƒ½] æœƒå“¡ç®¡ç†
      {
        path: 'members',
        name: 'member-list',
        component: MemberListView,
      },

      // æœƒå“¡ç·¨è¼¯
      {
        path: 'members/edit/:id',
        name: 'member-edit',
        component: MemberEditView,
      },

      // æœƒå“¡æ–°å¢
      {
        path: 'members/create',
        name: 'member-create',
        component: MemberCreateView,
      },

      // [æ ¸å¿ƒåŠŸèƒ½] ç®¡ç†å“¡ç®¡ç†
      {
        path: 'admins',
        name: 'admin-list',
        component: AdminListView,
      },

      // ç®¡ç†å“¡æ–°å¢
      {
        path: 'admins/create',
        name: 'admin-create',
        component: AdminCreateView,
      },

      // ç®¡ç†å“¡ç·¨è¼¯
      {
        path: 'admins/edit/:id',
        name: 'admin-edit',
        component: AdminEditView,
      },

      // [åŠŸèƒ½] ç§Ÿå€Ÿè¨‚å–®ç®¡ç†
      {
        path: 'rec-rent',
        name: 'rec-rent',
        component: () => import('@/views/rec/RecRentMgnPage.vue'),
      },
      {
        path: 'rec-chart',
        name: 'rec-chart',
        component: () => import('@/views/rec/RecRentMgnChartPage.vue'),
      },

      // [åŠŸèƒ½] ç¶­ä¿®ç®¡ç† (Maintenance)
      {
        path: 'staff-list',
        name: 'staff-list',
        component: () => import('@/views/maintenance/MaintenanceStaffList.vue'),
      },

      // ç¶­ä¿®äººå“¡è¡¨å–® (æ–°å¢/ç·¨è¼¯)
      {
        path: 'staff-form/:id?',
        name: 'staff-form',
        component: () => import('@/views/maintenance/MaintenanceStaffForm.vue'),
      },

      // ç¶­ä¿®äººå“¡æ­·å²ç´€éŒ„
      {
        path: 'staff-history',
        name: 'staff-history',
        component: () => import('@/views/maintenance/MaintenanceStaffHistory.vue'),
      },

      // ç¶­ä¿®å·¥å–®åˆ—è¡¨èˆ‡è¡¨å–®
      {
        path: 'mtif-list',
        name: 'mtif-list',
        component: () => import('@/views/maintenance/MtifList.vue'),
        props: { historyMode: false },
      },

      // ç¶­ä¿®å·¥å–®æ­·å²ç´€éŒ„
      {
        path: 'mtif-history',
        name: 'mtif-history',
        component: () => import('@/views/maintenance/MtifList.vue'),
        props: { historyMode: true },
      },

      // ç¶­ä¿®å·¥å–®è¡¨å–® (æ–°å¢/ç·¨è¼¯)
      {
        path: 'mtif-form/:id?',
        name: 'mtif-form',
        component: () => import('@/views/maintenance/MtifForm.vue'),
      },

      // --- Schedule (æ’ç¨‹) ---
      {
        path: 'maintenance/schedule',
        name: 'schedule-list',
        component: () => import('@/views/maintenance/ScheduleList.vue'),
      },

      // æ’ç¨‹è¡¨å–® (æ–°å¢/ç·¨è¼¯)
      {
        path: 'maintenance/schedule/create',
        name: 'schedule-create',
        component: () => import('@/views/maintenance/ScheduleForm.vue'),
      },

      // æ’ç¨‹ç·¨è¼¯
      {
        path: 'maintenance/schedule/edit/:id',
        name: 'schedule-edit',
        component: () => import('@/views/maintenance/ScheduleForm.vue'),
      },
    ],
  },

  // ==========================================
  // 4. è·¯ç”±å®ˆè¡›èˆ‡è½‰å€ (Redirects)
  // ==========================================

  {
    path: '/:pathMatch(.*)*',
    redirect: '/',
  },
]

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes,
})

/**
 * ==========================================
 * å…¨åŸŸè·¯ç”±å®ˆè¡›ï¼šå¾Œå°ç™»å…¥é©—è­‰ï¼ˆçµ±ä¸€ localStorageï¼‰
 * ==========================================
 */
router.beforeEach((to, from, next) => {
  // 1. å¦‚æœä¸æ˜¯å»å¾Œå°ï¼Œç›´æ¥æ”¾è¡Œ
  if (!to.path.startsWith('/admin')) {
    next()
    return
  }

  // 2. å–å¾— localStorage è³‡æ–™
  const token = localStorage.getItem('token')
  const adminJson = localStorage.getItem('admin')

  // Debug ç”¨ï¼šå¦‚æœé€²ä¸å»ï¼Œè«‹æŒ‰ F12 çœ‹ Console
  console.log('è·¯ç”±å®ˆè¡›æª¢æŸ¥:', { path: to.path, hasToken: !!token, hasAdmin: !!adminJson })

  // 3. åˆ¤æ–·æ˜¯å¦æœ‰ç®¡ç†å“¡èº«åˆ†
  if (adminJson) {
    // åªè¦æœ‰ admin è³‡æ–™å°±è®“å®ƒé€²å» (Token è¦–å¾Œç«¯æ””æˆªå™¨è€Œå®š)
    next()
  } else {
    // æ²’è³‡æ–™æ‰è·³è­¦å‘Š
    Swal.fire({
      icon: 'warning',
      title: 'è«‹å…ˆç™»å…¥',
      text: 'ç®¡ç†å“¡å¸³è™Ÿå·²éæœŸæˆ–å°šæœªç™»å…¥ã€‚',
      confirmButtonText: 'å»ç™»å…¥',
      allowOutsideClick: false,
    }).then(() => {
      next('/login')
    })
  }
})

export default router
</file>

</files>
