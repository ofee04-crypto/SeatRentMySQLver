import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { memo, useMemo } from 'react';
import cls from 'classnames';
import { View } from '@tarojs/components';
import { logger } from "../../../utils";
import { OnBoarding } from "../../../ui-kit";
import { useSendMessage } from "../../../services";
import { useChatInfoStore, useChatMaxWidth, useChatPropsStore, useConversationStore, useUserInfoStore, } from "../../../provider";
import { ChatScrollView } from '../chat-scroll-view';
import { ChatInput } from '../chat-input';
import { ChatGroupList } from '../chat-group-list';
import styles from './index.module.less';
const ChatOnBoarding = memo(() => {
    const { chatInfo } = useChatInfoStore(store => ({
        chatInfo: store.info,
    }));
    const onImageClick = useChatPropsStore(store => { var _a; return (_a = store.eventCallbacks) === null || _a === void 0 ? void 0 : _a.onImageClick; });
    const { sendTextMessage } = useSendMessage();
    const userInfo = useUserInfoStore(store => store.info);
    const { isShowOnBoarding } = useConversationStore(store => ({
        isShowOnBoarding: store.isShowOnBoarding,
        chatMessageGroups: store.chatMessageGroups,
        inProcessChatMessageGroup: store.inProcessChatMessageGroup,
    }));
    logger.debug('ChatOnBoarding:', chatInfo, isShowOnBoarding());
    if (!isShowOnBoarding()) {
        return null;
    }
    return (_jsx(OnBoarding, { user: userInfo || undefined, chat: chatInfo || undefined, onImageClick: onImageClick, onClickSuggestion: message => {
            sendTextMessage === null || sendTextMessage === void 0 ? void 0 : sendTextMessage(message);
        } }));
});
export const ChatSlot = memo(({ className }) => {
    const maxWidth = useChatMaxWidth();
    const chatSlotClassName = useChatPropsStore(store => { var _a; return (_a = store.ui) === null || _a === void 0 ? void 0 : _a.chatSlotClassName; });
    logger.debug('ChatSlot maxWidth', maxWidth);
    const chatContent = useMemo(() => (
    //防止每次刷新ChatScrollView
    _jsxs(_Fragment, { children: [_jsx(ChatOnBoarding, {}), _jsx(ChatGroupList, {})] })), []);
    return (_jsxs(View, Object.assign({ className: cls(styles.slot, chatSlotClassName, className), style: {
            maxWidth,
        } }, { children: [_jsx(ChatScrollView, { children: chatContent }), _jsx(ChatInput, {})] })));
});
//# sourceMappingURL=index.js.map