import { jsx as _jsx } from "react/jsx-runtime";
import { useEffect, useState } from 'react';
import cls from 'classnames';
import { previewImage } from '@tarojs/taro';
import { Image as TaroImage } from '@tarojs/components';
import { useMdStreamContext } from '../../../context';
import styles from './index.module.less';
export const Image = ({ node }) => {
    const { onImageClick, eventCallbacks, imgClassName, imgStyle } = useMdStreamContext();
    const [url, setUrl] = useState(node.url);
    useEffect(() => {
        setUrl(node.url);
    }, [node]);
    return (_jsx(TaroImage, { src: url, mode: "aspectFill", className: cls(styles.image, {
            [styles['image-error']]: !url,
        }, imgClassName), onError: () => {
            setUrl('');
        }, style: imgStyle, onClick: () => {
            if (node.url) {
                if (eventCallbacks === null || eventCallbacks === void 0 ? void 0 : eventCallbacks.onImageClick) {
                    eventCallbacks.onImageClick({ url: node.url });
                }
                else if (onImageClick) {
                    onImageClick === null || onImageClick === void 0 ? void 0 : onImageClick({ url: node.url });
                }
                else {
                    previewImage({
                        urls: [node.url],
                        current: node.url,
                        enableShowPhotoDownload: true,
                    });
                }
            }
        } }));
};
//# sourceMappingURL=index.js.map