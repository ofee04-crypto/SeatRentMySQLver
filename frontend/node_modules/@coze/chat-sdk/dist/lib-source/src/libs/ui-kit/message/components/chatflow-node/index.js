import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useMemo, useState } from 'react';
import cls from 'classnames';
import { Input, Text, View } from '@tarojs/components';
import { useI18n } from "../../../../provider";
import { extractChatflowMessage } from '../../helper/extract-chatlow-message';
import { Spacing } from '../../../atomic/spacing';
import { Button } from '../../../atomic/button';
import styles from './index.module.less';
const InputNode = ({ data, sendTextMessage, disabled }) => {
    var _a;
    const [inputData, setInputData] = useState({});
    const [hasSend, setHasSend] = useState(false);
    const realDisabled = disabled || hasSend;
    const i18n = useI18n();
    return (_jsxs(Spacing, Object.assign({ className: cls(styles['input-node'], {
            [styles.disabled]: realDisabled,
        }), gap: 12, vertical: true }, { children: [(_a = data === null || data === void 0 ? void 0 : data.input_card_data) === null || _a === void 0 ? void 0 : _a.map((item, index) => (_jsxs(Spacing, Object.assign({ gap: 6, vertical: true }, { children: [_jsx(Text, Object.assign({ className: styles['input-node-text'], overflow: "ellipsis", numberOfLines: 1 }, { children: item === null || item === void 0 ? void 0 : item.name })), _jsx(Input, { className: styles['input-node-input'], maxlength: -1, disabled: disabled || hasSend, placeholder: i18n.t('chatflowNodeInputPlaceholder'), onInput: event => {
                            setInputData(Object.assign(Object.assign({}, inputData), { [item.name]: event.detail.value || '' }));
                        } })] }), index))), _jsx(Button, Object.assign({ className: styles.btn, onClick: () => {
                    var _a;
                    if (realDisabled) {
                        return;
                    }
                    setHasSend(true);
                    sendTextMessage === null || sendTextMessage === void 0 ? void 0 : sendTextMessage(((_a = data === null || data === void 0 ? void 0 : data.input_card_data) === null || _a === void 0 ? void 0 : _a.map(item => `${item.name}:${inputData[item.name] || ''}`).join('\n')) || '');
                } }, { children: i18n.t('submit') }))] })));
};
const SwitchNode = ({ data, disabled, sendTextMessage }) => {
    var _a, _b, _c;
    const [hasSend, setHasSend] = useState(false);
    const realDisabled = disabled || hasSend;
    return (_jsxs(View, Object.assign({ className: cls(styles['switch-node'], {
            [styles.disabled]: realDisabled,
        }) }, { children: [_jsx(Text, Object.assign({ className: styles['switch-node-text'] }, { children: (_a = data === null || data === void 0 ? void 0 : data.question_card_data) === null || _a === void 0 ? void 0 : _a.Title })), _jsx(Spacing, Object.assign({ vertical: true, gap: 6 }, { children: (_c = (_b = data === null || data === void 0 ? void 0 : data.question_card_data) === null || _b === void 0 ? void 0 : _b.Options) === null || _c === void 0 ? void 0 : _c.map((item, index) => (_jsx(View, Object.assign({ className: styles['switch-node-switch-item'], onClick: () => {
                        if (disabled) {
                            return;
                        }
                        setHasSend(true);
                        sendTextMessage === null || sendTextMessage === void 0 ? void 0 : sendTextMessage(item.name);
                    } }, { children: _jsx(Text, Object.assign({ className: styles['switch-node-switch-item-text'] }, { children: item.name })) }), index))) }))] })));
};
export const ChatflowNode = ({ message, sendTextMessage, disabled }) => {
    const chatflowNodeData = useMemo(() => extractChatflowMessage(message), [message]);
    if (!chatflowNodeData) {
        return null;
    }
    return (_jsxs(_Fragment, { children: [chatflowNodeData.card_type === 'INPUT' ? (_jsx(InputNode, { data: chatflowNodeData, sendTextMessage: sendTextMessage, disabled: disabled })) : null, chatflowNodeData.card_type === 'QUESTION' ? (_jsx(SwitchNode, { data: chatflowNodeData, sendTextMessage: sendTextMessage, disabled: disabled })) : null] }));
};
//# sourceMappingURL=index.js.map