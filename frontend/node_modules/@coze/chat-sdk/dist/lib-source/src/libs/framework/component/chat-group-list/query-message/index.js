import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { memo } from 'react';
import cls from 'classnames';
import { View } from '@tarojs/components';
import { MessageContent, MessageContainer, Spinning, SvgError, } from "../../../../ui-kit";
import { useSendMessage } from "../../../../services";
import { useChatPropsStore, useUserInfoStore } from "../../../../provider";
import { CommandTooltip } from '../command/comman-tooltip';
import styles from './index.module.less';
export const QueryMessage = memo(({ message, isAWaiting = false, hasRespMessage, isLastMessage = false, chatGroup, }) => {
    const userInfo = useUserInfoStore(store => store.info);
    const { reSendLastErrorMessage } = useSendMessage();
    const isShowError = message.error && !hasRespMessage;
    const isShowLoading = !isShowError && isAWaiting && !message.chat_id;
    const { sendTextMessage } = useSendMessage();
    const onImageClick = useChatPropsStore(store => { var _a; return (_a = store.eventCallbacks) === null || _a === void 0 ? void 0 : _a.onImageClick; });
    const messageWrapperConf = useChatPropsStore(store => { var _a, _b; return (_b = (_a = store.ui) === null || _a === void 0 ? void 0 : _a.chatSlot) === null || _b === void 0 ? void 0 : _b.messageWrapper; });
    return (_jsx(MessageContainer, Object.assign({ senderInfo: userInfo || undefined, className: styles['query-container'], isQuery: true, chatGroup: chatGroup, messageWrapperConf: messageWrapperConf }, { children: _jsxs(View, Object.assign({ className: styles['query-message'] }, { children: [_jsx(CommandTooltip, Object.assign({ message: message, isActive: !message.isAudioTranslatingToText }, { children: _jsx(MessageContent, { message: message, onImageClick: onImageClick, sendTextMessage: sendTextMessage }) })), isShowLoading ? (_jsx(Spinning, { className: styles['state-slot'], size: "small" })) : null, isShowError ? (_jsx(SvgError, { className: cls(styles['state-slot'], {
                        [styles.disable]: !isLastMessage,
                    }), onClick: () => isLastMessage && (reSendLastErrorMessage === null || reSendLastErrorMessage === void 0 ? void 0 : reSendLastErrorMessage()) })) : null] })) })));
});
//# sourceMappingURL=index.js.map