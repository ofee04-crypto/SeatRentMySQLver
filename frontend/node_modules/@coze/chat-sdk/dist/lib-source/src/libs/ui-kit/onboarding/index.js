import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { useMemo } from 'react';
import cls from 'classnames';
import { View, Text } from '@tarojs/components';
import { getCdnUrl, logger } from "../../utils";
import { useChatPropsStore, useIsMobile } from "../../provider";
import { SuggestionList } from '../suggestion-list';
import { MarkdownMessage } from '../message/components/markdown';
import { ErrorBoundary } from '../atomic/error-boundary';
import { CImage } from '../atomic/c-image';
import styles from './index.module.less';
export const OnBoarding = ({ chat: chatInfo, user: userInfo, onClickSuggestion, onImageClick, }) => {
    var _a, _b, _c, _d, _e;
    const cdnBaseurlPath = useChatPropsStore(store => { var _a; return (_a = store.setting) === null || _a === void 0 ? void 0 : _a.cdnBaseUrlPath; });
    const prologue = useMemo(() => {
        var _a;
        const formatPrologue = (((_a = chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.onboarding_info) === null || _a === void 0 ? void 0 : _a.prologue) || '').replaceAll('{{user_name}}', (userInfo === null || userInfo === void 0 ? void 0 : userInfo.name) || '');
        return formatPrologue !== '\n' ? formatPrologue : '';
    }, [(_a = chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.onboarding_info) === null || _a === void 0 ? void 0 : _a.prologue]);
    const isVerticalCenter = !prologue && !((_c = (_b = chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.onboarding_info) === null || _b === void 0 ? void 0 : _b.suggested_questions) === null || _c === void 0 ? void 0 : _c.length);
    const isMobile = useIsMobile();
    logger.debug('OnBoarding props', prologue, chatInfo);
    return (_jsxs(View, Object.assign({ className: cls(styles.container, {
            [styles['vertical-center']]: isVerticalCenter,
        }) }, { children: [_jsxs(View, Object.assign({ className: styles['info-container'] }, { children: [_jsx(CImage, { src: (chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.icon_url) ||
                            getCdnUrl(cdnBaseurlPath, 'assets/imgs/coze-logo.png'), className: styles['app-avatar'], mode: "aspectFill" }), _jsx(Text, Object.assign({ className: styles['chat-name'], overflow: "ellipsis", numberOfLines: 1, maxLines: 1 }, { children: (chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.name) || '' })), _jsx(ErrorBoundary, Object.assign({ fallbackNode: _jsx(_Fragment, {}) }, { children: prologue ? (_jsx(MarkdownMessage, { content: prologue, isComplete: true, className: styles.prologue, onImageClick: onImageClick })) : null }))] })), _jsx(SuggestionList, { suggestions: ((_d = chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.onboarding_info) === null || _d === void 0 ? void 0 : _d.suggested_questions) || [], onClickSuggestion: onClickSuggestion, isDisplayAll: (_e = chatInfo === null || chatInfo === void 0 ? void 0 : chatInfo.onboarding_info) === null || _e === void 0 ? void 0 : _e.display_all_suggestions, isVertical: isMobile })] })));
};
//# sourceMappingURL=index.js.map