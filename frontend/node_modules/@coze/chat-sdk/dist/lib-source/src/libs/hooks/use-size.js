import { useEffect, useState } from 'react';
import { getBoundingRect, isWeb } from "../utils";
import { usePersistCallback } from './use-persist-callback';
export const useSize = (id) => {
    const [size, setState] = useState(() => ({
        width: 0,
        height: 0,
    }));
    const reInitSize = usePersistCallback(() => {
        if (isWeb) {
            const el = document.getElementById(id);
            if (el) {
                return {
                    width: el.clientWidth,
                    height: el.clientHeight,
                };
            }
        }
        else {
            getBoundingRect(`#${id}`).then(res => {
                var _a;
                if ((_a = res === null || res === void 0 ? void 0 : res[0]) === null || _a === void 0 ? void 0 : _a.width) {
                    setState({
                        width: res[0].width,
                        height: res[0].height,
                    });
                }
            });
        }
    });
    useEffect(() => {
        reInitSize();
    }, [id]);
    useEffect(() => {
        //网页监听变化
        if (!isWeb) {
            return;
        }
        const el = document.getElementById(id);
        if (!el) {
            return;
        }
        const resizeObserver = new ResizeObserver(entries => {
            entries.forEach(entry => {
                const { clientWidth, clientHeight } = entry.target;
                setState({ width: clientWidth, height: clientHeight });
            });
        });
        resizeObserver.observe(el);
        return () => {
            resizeObserver.disconnect();
        };
    }, [id]);
    return Object.assign(Object.assign({}, size), { reInitSize });
};
//# sourceMappingURL=use-size.js.map