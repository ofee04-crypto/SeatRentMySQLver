import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useMemo, useState } from 'react';
import cls from 'classnames';
import { logger } from "../../../../utils";
import { useI18n } from "../../../../provider";
import { usePersistCallback, useUpdateEffect } from "../../../../hooks";
import { MdStream } from '../../../atomic/md-stream';
import { Bubble } from '../../../atomic/bubble';
import styles from './index.module.less';
const MarkdownContent = ({ content, isComplete = true, onImageClick, onLinkClick, taskDisabled, onTaskChange, className, }) => {
    const [isSmooth, setIsSmooth] = useState(!isComplete);
    const i18n = useI18n();
    const onMarkdownEnd = usePersistCallback(() => {
        if (isSmooth !== false) {
            setIsSmooth(false);
        }
    });
    useUpdateEffect(() => {
        onMarkdownEnd();
    }, [isComplete]);
    const markdownEventCallback = useMemo(() => ({
        onLinkClick: onLinkClick
            ? (_e, data) => {
                onLinkClick === null || onLinkClick === void 0 ? void 0 : onLinkClick(data === null || data === void 0 ? void 0 : data.url);
            }
            : undefined,
    }), [onLinkClick]);
    return (_jsx(MdStream, { className: className, markdown: content, isSmooth: isSmooth, isFinish: isComplete, onMarkdownEnd: onMarkdownEnd, theme: "light", onImageClick: onImageClick, onTaskChange: onTaskChange, taskDisabled: taskDisabled, language: i18n.language, eventCallbacks: markdownEventCallback, debug: logger.isDebug() }));
};
export const MarkdownMessage = ({ reasoningContent, content, isComplete = true, className, onImageClick, onLinkClick, taskDisabled, onTaskChange, }) => {
    const reasonMessage = useMemo(() => {
        if (reasoningContent) {
            return reasoningContent.trim().replace(/^/gm, '> ');
        }
        return '';
    }, [reasoningContent]);
    return (_jsxs(Bubble, Object.assign({ isNeedBorder: false, className: cls(styles.markdown, className) }, { children: [reasonMessage ? (_jsx(MarkdownContent, Object.assign({}, { onImageClick, onLinkClick }, { taskDisabled: true, className: styles.reason, isComplete: isComplete || !!content, content: reasonMessage }))) : null, !reasonMessage || content ? (_jsx(MarkdownContent, Object.assign({}, {
                isComplete,
                onImageClick,
                onLinkClick,
                onTaskChange,
                taskDisabled,
            }, { content: content }))) : null] })));
};
//# sourceMappingURL=index.js.map