import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { safeJSONParse } from "../../../utils";
import { useI18n } from "../../../provider";
import { extractChatflowMessage } from '../helper/extract-chatlow-message';
import { TextMessage } from '../components/text';
import { MarkdownMessage } from '../components/markdown';
import { ImageMessage } from '../components/image';
import { FileMessage } from '../components/file';
import { ChatflowNode } from '../components/chatflow-node';
import { ErrorBoundary } from '../../atomic/error-boundary';
const getObjectValue = (objectString) => safeJSONParse(objectString, []);
export const MessageContent = props => {
    const { message, isAWaiting } = props;
    const i18n = useI18n();
    return (_jsxs(ErrorBoundary, Object.assign({ fallbackNode: !isAWaiting ? _jsx(TextMessage, { content: i18n.t('noAnswer') }) : _jsx(_Fragment, {}) }, { children: [message.content_type === 'text' ? _jsx(TextItem, Object.assign({}, props)) : null, message.content_type === 'object_string' ? (_jsx(ObjectStringItem, Object.assign({}, props))) : null, message.content_type === 'card' ? _jsx(CardItem, Object.assign({}, props)) : null] })));
};
const TextItem = props => {
    const { message, isAWaiting, onImageClick, onLinkClick, onTaskChange, messageUiConfigMap, isLastMessage, } = props;
    const { renderMessage } = (messageUiConfigMap === null || messageUiConfigMap === void 0 ? void 0 : messageUiConfigMap.text) || {};
    if (message.content_type !== 'text') {
        return null;
    }
    return (_jsx(_Fragment, { children: (renderMessage === null || renderMessage === void 0 ? void 0 : renderMessage(props)) || (_jsx(_Fragment, { children: message.type === 'question' ? (_jsx(TextMessage, { content: message.content, isLoadingText: message.isAudioTranslatingToText })) : (_jsx(MarkdownMessage, { reasoningContent: message.reasoning_content, content: message.content, isComplete: !isAWaiting || message.isComplete, onImageClick: onImageClick, onLinkClick: onLinkClick, onTaskChange: onTaskChange, taskDisabled: !isLastMessage })) })) }));
};
const ObjectStringItem = props => {
    var _a;
    const { message, onImageClick, messageUiConfigMap, onTaskChange, onLinkClick, isLastMessage, } = props;
    const i18n = useI18n();
    const { renderMessage } = (messageUiConfigMap === null || messageUiConfigMap === void 0 ? void 0 : messageUiConfigMap.text) || {};
    if (message.content_type !== 'object_string') {
        return null;
    }
    return (_jsx(_Fragment, { children: (renderMessage === null || renderMessage === void 0 ? void 0 : renderMessage(props)) ||
            ((_a = getObjectValue(message.content)) === null || _a === void 0 ? void 0 : _a.map((item, index) => {
                switch (item.type) {
                    case 'text': {
                        return (_jsx(_Fragment, { children: message.type === 'question' ? (_jsx(TextMessage, { content: item.text, isLoadingText: message.isAudioTranslatingToText })) : (_jsx(MarkdownMessage, { content: item.text, isComplete: true, onLinkClick: onLinkClick, onImageClick: onImageClick, onTaskChange: onTaskChange, taskDisabled: !isLastMessage })) }));
                    }
                    case 'file': {
                        return (_jsx(FileMessage, { filename: item.name || '', size: item.size || 0 }, `${item.type}_${index}`));
                    }
                    case 'image': {
                        return (_jsx(ImageMessage, { url: item.file_url, onImageClick: onImageClick }, `${item.type}_${index}`));
                    }
                    default: {
                        return (_jsx(TextMessage, { content: i18n.t('messageTypeUnSupport') }, `${item.type}_${index}`));
                    }
                }
            })) }));
};
const CardItem = props => {
    const { message, messageUiConfigMap, sendTextMessage, isLastMessage, isReadOnly, } = props;
    const { renderMessage: renderCardMessage } = (messageUiConfigMap === null || messageUiConfigMap === void 0 ? void 0 : messageUiConfigMap.card) || {};
    const { renderMessage: renderChatflowNodeMessage } = (messageUiConfigMap === null || messageUiConfigMap === void 0 ? void 0 : messageUiConfigMap.chatflow_node) || {};
    const chatflowNodeData = extractChatflowMessage(message);
    const isChatflowNode = Boolean(chatflowNodeData);
    if (message.content_type !== 'card') {
        return null;
    }
    return (_jsx(_Fragment, { children: isChatflowNode
            ? (renderChatflowNodeMessage === null || renderChatflowNodeMessage === void 0 ? void 0 : renderChatflowNodeMessage(props)) || (_jsx(ChatflowNode, { message: message, sendTextMessage: sendTextMessage, disabled: !isLastMessage || isReadOnly }))
            : (renderCardMessage === null || renderCardMessage === void 0 ? void 0 : renderCardMessage(props)) || null }));
};
//# sourceMappingURL=index.js.map